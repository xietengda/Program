<!DOCTYPE html>
<html>

	<head>
		<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0" />
		<meta charset="UTF-8">
		<title>寒假报名</title>
		<link rel="stylesheet" href="http://qhb.lelego.net.cn/upload/tpl_file/public/module_swiper.min.css" />
		<link rel="stylesheet" href="http://qhb.lelego.net.cn/upload/tpl_file/public/mobiscroll.custom-2.5.2.min.css">
		<link rel="stylesheet" href="<{$template_path}>/witer_vacation03.css" />
		<style>
			body {
				background-color: #EDEDED;
			}
			
			#father {
				width: 80%;
				height: 80%;
				margin: 0 auto;
				padding-top: 10%;
			}
			
			#pageDiv {
			    position: fixed;
			    margin: 0 auto;
			    left: 0;
			    width: 80%;
			    margin-top: 0.1rem;
			    right: 0;
			}
			/*虚线*/
			
			.editBorder {
				border: 1px dashed black;
			}

			/*公共部分的预览页面html隐藏*/
			#prevSAndE{
				display: none;
			}
			
		</style>
	</head>

	<body>
		<!--编辑弹框和遮层-->
		<div id="edit_dialog" class="divHide">
			<textarea></textarea>
			<input id="edit_number_input" type="number" class="divHide" />
			<div id="edit_input_layer" class="divHide"></div>
			<ul>
				<li id="edit_qx" onclick="edit_qxFun()">取消</li>
				<li id="edit_length"><span>12</span>/<span>20</span></li>
				<li id="edit_qd" onclick="edit_qdFun()">确定</li>
			</ul>
		</div>
		<div id="edit_layer" class="divHide"></div>
		<!--编辑弹框和遮层-->
		

		<div id="father">
			<div class="swiper-container">
				<div class="swiper-wrapper">
					<div class="swiper-slide swi_bgi" id="swi1">
						<div id="swi1_title_img">
							<img src="<{$template_path}>/home_text@2x.png" />
						</div>
						<div id="swi1_cont_1" class="swi1_edit_cont_1">
							<ul class="float_div float_edit_div" id="swi1_cont_five" onclick="edit_onFuntion($(this),5)">
								<li id="ed1" class="editBorder">学</li>
								<li id="ed2" class="editBorder">&</li>
								<li id="ed3" class="editBorder">买</li>
								<li id="ed4" class="editBorder">互</li>
								<li id="ed5" class="editBorder">赠</li>
							</ul>
						</div>
						<div id="swi1_cont_2" class="swi1_edit_cont_2" onclick="edit_onFuntion($(this),55)">
							<p id="ed6" class="editBorder">小蜜蜂琴行特推出“学&买互赠”活动</p>
							<p id="ed7" class="editBorder">让我们在音乐中动起来 ，不用再担心学琴没琴了</p>
							<p id="ed8" class="editBorder">机会难得，你还犹豫什么呢？</p>
						</div>
						<div id="swi1_footer" class="swi1_edit_footer">
							<p>活动时间：<span class="editBorder"><span id="ed9">1</span>月<span id="ed10">10</span>日</span>至<span class="editBorder"><span id="ed11">2</span>月<span id="ed12">30</span>日</span></p>
							<input id="date_input_1" readonly="readonly" onfocus="this.blur()" />
							<input id="date_input_2" readonly="readonly" onfocus="this.blur()" />
						</div>
					</div>
					<div class="swiper-slide swi_bgi" id="swi2">
						<div class="swi_title swi_edit_title">
							<p id="ed13" onclick="edit_onFuntion($(this),4)" class="editBorder">特惠活动</p>
						</div>
						<div class="swi_cont swi_edit_cont">
							<div id="swi2_cont_1" class="swi2_cont editBorder">
								<div class="swi2_cont_title swi2_edit_cont_title">
									<img src="<{$template_path}>/all_sign@2x.png" />
									<p id="ed14" onclick="edit_onFuntion($(this),10)" class="editBorder">学钢琴赠钢琴活动</p>
								</div>
								<div class="swi2_cont_cont swi2_edit_cont_cont">
									<p id="ed15" onclick="edit_onFuntion($(this),35)" class="editBorder">凡在活动期间钢琴班一次性交满 2 年学费的学员，免费赠送钢琴一台！</p>
									<!--自定义图片1-->
									<img id="edimg1" onClick="clipPhoto('#edimg1_img',$(this),'350','140','0','1')" class="editBorder" src="<{$template_path}>/pic_01@2x.png" />
									<input id="edimg1_img" type="file" accept="image/*" style="display: none;" />
								</div>
								<span class="swi2_close_span" onclick="closeFun('#swi2_cont_1','#addBox1')">
									<img src="http://qhb.lelego.net.cn/upload/tpl_file/public/module_close.png"/>
								</span>
							</div>
							<!--添加框-->
							<div id="addBox1" class="swi2_addBox divHide" >
								<img onclick="addFun('#swi2_cont_1','#addBox1')" src='http://qhb.lelego.net.cn/upload/tpl_file/public/module_add.png' />
							</div>
							
							<div id="swi2_cont_2" class="swi2_cont editBorder">
								<div class="swi2_cont_title swi2_edit_cont_title">
									<img src="<{$template_path}>/all_sign@2x.png" />
									<p id="ed16" onclick="edit_onFuntion($(this),10)" class="editBorder">买钢琴赠课时活动</p>
								</div>
								<div class="swi2_cont_cont swi2_edit_cont_cont">
									<p id="ed17" onclick="edit_onFuntion($(this),35)" class="editBorder">凡在活动期间在小蜜蜂琴行购买钢琴即可获得价值1000元钢琴课课时卡。</p>
									<!--自定义图片2-->
									<img id="edimg2" onClick="clipPhoto('#edimg2_img',$(this),'350','140','1')" class="editBorder" src="<{$template_path}>/pic_02@2x.png" />
									<input id="edimg2_img" type="file" accept="image/*" style="display: none;" />
								</div>
								<span class="swi2_close_span" onclick="closeFun('#swi2_cont_2','#addBox2')">
									<img src="http://qhb.lelego.net.cn/upload/tpl_file/public/module_close.png"/>
								</span>
							</div>
							<!--添加框-->
							<div id="addBox2" class="swi2_addBox divHide" >
								<img onclick="addFun('#swi2_cont_2','#addBox2')" src='http://qhb.lelego.net.cn/upload/tpl_file/public/module_add.png' />
							</div>
						</div>

					</div>
					<div class="swiper-slide swi_bgi" id="swi3">
						<div class="swi_title swi_edit_title">
							<p id="ed18" onclick="edit_onFuntion($(this),4)" class="editBorder">琴行介绍</p>
						</div>
						<div class="swi_cont swi_edit_cont">
							<div id="swi3_cont_img" class="swi3_edit_cont_img editBorder">
								<!-- <img src="<{$template_path}>/pic_03@2x.png" /> -->
								<!--自定义图片3-->
								<img id="edimg3" onClick="clipPhoto('#edimg3_img',$(this),'350','200','2')" class="editBorder" src="<{$template_path}>/mater_pic.png" />
								<input id="edimg3_img" type="file" accept="image/*" style="display: none;" />
							</div>
							<div id="swi3_cont_p" class="swi3_edit_cont_p">
								<p id="ed19" onclick="edit_onFuntion($(this),140)" class="editBorder">小蜜蜂琴行成立于2015年，是子昊专业钢琴音乐教育旗下直营琴行，拥有15年行业经验。同时也是高明首家引进智能钢琴集体课的琴行，小蜜蜂琴行设备先进，师资雄厚。成立以来广受家长和学生好评。小蜜蜂学员在全国地方才艺大赛中均有优异的表现，其中更有不少的优秀学员取得了不俗的成绩。</p>
							</div>
						</div>
					</div>
					<div class="swiper-slide swi_bgi" id="swi4">
						<div class="swi_title swi_edit_title">
							<p id="ed20" onclick="edit_onFuntion($(this),4)" class="editBorder">课程介绍</p>
						</div>
						<div class="swi_cont swi_edit_cont">
							<div id="swi4_cont_1" class="swi4_cont swi4_edit_cont editBorder">
								<div class="swi4_cont_title swi4_edit_cont_title">
									<img src="<{$template_path}>/all_sign@2x.png" />
									<p id="ed21" onclick="edit_onFuntion($(this),8)" class="editBorder">钢琴启蒙班</p>
								</div>
								<div class="swi4_cont_p swi4_edit_cont_p">
									<p id="ed22" onclick="edit_onFuntion($(this),35)" class="editBorder">适合4-7岁的孩子，通过动画故事进行知识讲解通俗易懂，引人入胜。</p>
								</div>
								<span class="swi4_close_span" onclick="closeFun('#swi4_cont_1','#addBox3')">
									<img src="http://qhb.lelego.net.cn/upload/tpl_file/public/module_close.png"/>
								</span>
							</div>
							<!--添加框-->
							<div id="addBox3" class="swi4_addBox divHide" >
								<img onclick="addFun('#swi4_cont_1','#addBox3')" src='http://qhb.lelego.net.cn/upload/tpl_file/public/module_add.png' />
							</div>
							
							<div id="swi4_cont_2" class="swi4_cont swi4_edit_cont editBorder">
								<div class="swi4_cont_title swi4_edit_cont_title">
									<img src="<{$template_path}>/all_sign@2x.png" />
									<p id="ed23" onclick="edit_onFuntion($(this),8)" class="editBorder">一对一钢琴课</p>
								</div>
								<div class="swi4_cont_p swi4_edit_cont_p">
									<p id="ed24" onclick="edit_onFuntion($(this),35)" class="editBorder">目前最高效的钢琴授课方式，专业教师因材施教，让您的孩子进步更快。</p>
								</div>
								<span class="swi4_close_span" onclick="closeFun('#swi4_cont_2','#addBox4')">
									<img src="http://qhb.lelego.net.cn/upload/tpl_file/public/module_close.png"/>
								</span>
							</div>
							<!--添加框-->
							<div id="addBox4" class="swi4_addBox divHide" >
								<img onclick="addFun('#swi4_cont_2','#addBox4')" src='http://qhb.lelego.net.cn/upload/tpl_file/public/module_add.png' />
							</div>
							
							<div id="swi4_cont_3" class="swi4_cont swi4_edit_cont editBorder">
								<div class="swi4_cont_title swi4_edit_cont_title">
									<img src="<{$template_path}>/all_sign@2x.png" />
									<p id="ed25"  onclick="edit_onFuntion($(this),8)" class="editBorder">音基集体课</p>
								</div>
								<div class="swi4_cont_p swi4_edit_cont_p">
									<p id="ed26"  onclick="edit_onFuntion($(this),37)" class="editBorder">特色课程，音乐基础是学音乐的必修课，像学英语一样，学好了音标才能学好英语。</p>
								</div>
								<span class="swi4_close_span" onclick="closeFun('#swi4_cont_3','#addBox5')">
									<img src="http://qhb.lelego.net.cn/upload/tpl_file/public/module_close.png"/>
								</span>
								<div id="swi4_cont_3_footer" class="swi4_edit_cont_3_footer">
									<!-- <img src="<{$template_path}>/pic_04@2x.png" /> -->
									<!--自定义图片4-->
									<img id="edimg4" onClick="clipPhoto('#edimg4_img',$(this),'350','160','3')" class="editBorder" src="<{$template_path}>/pic_04@2x.png" />
									<input id="edimg4_img" type="file" accept="image/*" style="display: none;" />
								</div>
							</div>
							<!--添加框-->
							<div id="addBox5" class="divHide" >
								<img onclick="addFun('#swi4_cont_3','#addBox5')" src='http://qhb.lelego.net.cn/upload/tpl_file/public/module_add.png' />
							</div>
						</div>
					</div>
					<div class="swiper-slide swi_bgi" id="swi5">
						<div class="swi_title swi_edit_title">
							<p id="ed27"  onclick="edit_onFuntion($(this),4)" class="editBorder">联系方式</p>
						</div>
						<div class="swi_cont swi_edit_cont">
							<div class="swi5_cont_div swi5_edit_cont_div">
								<div class="swi5_cont_title swi5_edit_cont_title">
									<img src="<{$template_path}>/all_sign@2x.png" />
									<p>联系电话</p>
								</div>
								<div class="swi5_cont_cont swi5_edit_cont_cont">
									<p>欢迎拨打<span id="ed28"  onclick="edit_onFuntion($(this),15)" class="editBorder">075788889031</span>进行咨询</p>
								</div>
							</div>
							<div class="swi5_cont_div swi5_edit_cont_div">
								<div class="swi5_cont_title swi5_edit_cont_title">
									<img src="<{$template_path}>/all_sign@2x.png" />
									<p>联系地址</p>
								</div>
								<div  class="swi5_cont_cont swi5_edit_cont_cont">
									<p>店址为：<span id="ed29" class="editBorder" onclick="new_map('#ed29')" >佛山市高明区跃华路小蜜蜂琴行（永安花园对面）</span></p>
								</div>
							</div>
							<div id="swi5_map" onclick="new_map('#ed29')" class="swi5_edit_map">
								<div class=" Frame_wap_user_organization_edit" id="Frame60">
									<form action="" method="post" id="Frame60_form_1">
										<input name="id" type="hidden" value="60" />
										<input name="oid" type="hidden" value="1" />
										<div class="main pt10">
											<input type="hidden" name="lat" /> <input type="hidden" name="lng" />
											<div id="container_61" class="map" style="z-index:99"></div>
											<div class="dno" id="Address_list"></div>
										</div>
									</form>
								</div>
							</div>
							<div id="swi5_footer" class="swi5_edit_footer">
								<ul class="float_div"> 
									<li id="zixun"><a href="javascript:void(0)">我要咨询</a></li>
									<li>我要报名</li>
								</ul>
							</div>
						</div>
					</div>
					<!-- Add Pagination -->
					<div class="swiper-pagination"></div>
				</div>
				
			</div>
		</div>

		<!--底部光标-->
		<div id="pageDiv">
			<!--页数-->
			<div id="pageNum"><span>1</span>/5</div>
		</div>

		<!--公共部分-->
		<{include '../public/public_module_pangda.html'}>
		
	</body>
	<script type="text/javascript" src="https://cdn.bootcss.com/jquery/2.2.0/jquery.min.js"></script>
	<script type="text/javascript" src="http://qhb.lelego.net.cn/upload/tpl_file/public/adaptive.js"></script>
	<script type="text/javascript" src="http://qhb.lelego.net.cn/upload/tpl_file/public/module_swiper.js"></script>
	<!--地图-->
	<script charset="utf-8" src="http://map.qq.com/api/js?v=2.exp&libraries=convertor"></script>
	<script type="text/javascript" src="https://3gimg.qq.com/lightmap/components/geolocation/geolocation.min.js"></script>
	<script type="text/javascript" src="http://qhb.lelego.net.cn/upload/tpl_file/public/module_wap_qq_map.js"></script>
	<!-- <script type="text/javascript" src="http://qhb.lelego.net.cn/plugins/layui/layui.js"></script> -->
	<!--图片插件-->
	<script src="http://qhb.lelego.net.cn/js/LocalResizeIMG/patch/mobileBUGFix.mini.js"></script>
	<script type="text/javascript" src="http://qhb.lelego.net.cn/upload/tpl_file/public/module_LocalResizeIMG.js"></script>
	<!--图片裁剪-->
	<script type="text/javascript" src="http://qhb.lelego.net.cn/upload/tpl_file/public/jquery.photoClip.js"></script>
	<script type="text/javascript" src="http://qhb.lelego.net.cn/upload/tpl_file/public/hammer.js"></script>
	<script type="text/javascript" src="http://qhb.lelego.net.cn/upload/tpl_file/public/iscroll-zoom.js"></script>
	<script type="text/javascript" src="http://qhb.lelego.net.cn/upload/tpl_file/public/sonic.js"></script>
	<!--日期插件-->
	<script type="text/javascript" src="http://qhb.lelego.net.cn/upload/tpl_file/public/mobiscroll.core-2.5.2.js"></script>
	<script type="text/javascript" src="http://qhb.lelego.net.cn/upload/tpl_file/public/mobiscroll.datetime-2.5.1.js"></script>
	<script>
		//文字图片保存Json
		var textJson = {};
		//位置坐标x
		var positionX = 0;
		//位置坐标Y
		var positionY = 0;
		//自定义图片
		var imgArr = new Array();
		//背景音乐(默认)
		var bgdMusic;
		//分享封面图片
		var tal_shareBgi = new Array();
		//编辑页面显示的地图
		var map61 = new wap_qq_map('container_61');


		//是否是编辑页面的标识
		var isEdit = "true";


		//机构名称
		var organization_name = '';


		//分享标题
		var shareTitle = '寒假报名';
		//分享描述
		var shareRemark = '' ;
		//分享模板名
		var shareProName = '寒假报名01';




		$(document).ready(function() {
			//判断previewJson是否为空(如果不为空在判断是否是新增，如果为空则渲染templateJson数据)
			if('<{$user_preview_json}>' == '{}') {
				//判断是否是新增（根据'<{$user_template_id}>'== 0判断）
				console.log(<{$user_template_id}>);
				if('<{$user_template_id}>' == '0'){

					//课程赋值
					var org_class_schedule = JSON.stringify(<{$org_class_schedule_list}>);
					var org_class_schedule_list = jQuery.parseJSON(org_class_schedule);
					// console.log(org_class_schedule_list);
					if(org_class_schedule_list != null){
						for(var i = 0;i <= 3;i++){
							if(i == 0 && org_class_schedule_list[i] != undefined){
								//课程1
								$('#ed21').text(org_class_schedule_list[i].course_name || '钢琴启蒙班');
								$('#ed22').text(org_class_schedule_list[i].introduction || '适合4-7岁的孩子，通过动画故事进行知识讲解通俗易懂，引人入胜。');
							}else if(i == 1 && org_class_schedule_list[i] != undefined){
								//课程2
								$('#ed23').text(org_class_schedule_list[i].course_name || '一对一钢琴课');
								$('#ed24').text(org_class_schedule_list[i].introduction || '目前最高效的钢琴授课方式，专业教师因材施教，让您的孩子进步更快。');
							}else if(i == 2 && org_class_schedule_list[i] != undefined){
								//课程3
								$('#ed25').text(org_class_schedule_list[i].course_name || '一对一钢琴课');
								$('#ed26').text(org_class_schedule_list[i].introduction || '目前最高效的钢琴授课方式，专业教师因材施教，让您的孩子进步更快。');
								$('#edimg4').attr('src',org_class_schedule_list[i].image || '<{$template_path}>/pic_04@2x.png');
							}
						}
					}


					//分享描述的赋值
					shareRemark = '<{$organization_name}>' != ''?'<{$organization_name}>'+'祝大家寒假快乐':'小蜜蜂琴行祝大家寒假快乐！' ;

					//从后台读取一些操作者数据
					$('#ed6').text('<{$organization_name}>' != ''?'<{$organization_name}>'+'特推出“学&买互赠”活动':'小蜜蜂琴行特推出“学&买互赠”活动');//:机构名称
					$('#ed29').text('<{$organization_address}>' || '佛山市高明区跃华路小蜜蜂琴行（永安花园对面）');//:机构地址
					$('#ed28').text('<{$organization_phone}>' || '075788889031');//:机构电话
					$('#ed19').text('<{$organization_intro}>' || '小蜜蜂琴行成立于2015年，是子昊专业钢琴音乐教育旗下直营琴行，拥有15年行业经验。同时也是高明首家引进智能钢琴集体课的琴行，小蜜蜂琴行设备先进，师资雄厚。成立以来广受家长和学生好评。小蜜蜂学员在全国地方才艺大赛中均有优异的表现，其中更有不少的优秀学员取得了不俗的成绩。');//:机构简介
					positionX = '<{$organization_lat}>' || '22.896310';//:机构所在地址的经度
					positionY = '<{$organization_lng}>' || '112.867850';//:机构所在地址的纬度

					//首次进入，定位到默认位置
					map61.init(positionX,positionY);

					//将机构名称放进json里保存
					organization_name = '<{$organization_name}>';

					//新增就音乐一个默认值
					bgdMusic = 'http://qhb.lelego.net.cn/upload/ed-pic/5896a94e24168/5a0fd62ac33f2/5a0fd65bb1702.mp3';
					return bgdMusic;
					return positionX;
					return positionY;
					return organization_name;
				}else{
					//从列表的编辑进入页面
					var textJson_tem  = <{$user_template_json}>;
					console.log("列表编辑=$user_template_json==="+JSON.stringify(textJson_tem));

					

					//渲染文字
					for(var key in textJson_tem){
						if(key =='ed14' || key =='ed15'){
							if(textJson_tem[key] == 'hide'){
								$('#swi2_cont_1').addClass('divHide');
								$('#addBox1').removeClass('divHide');
							}else{
								$($('#'+key+'').selector).html(textJson_tem[key]);
							}
						}else if(key =='ed16' || key =='ed17'){
							if(textJson_tem[key] == 'hide'){
								$('#swi2_cont_2').addClass('divHide');
								$('#addBox2').removeClass('divHide');
							}else{
								$($('#'+key+'').selector).html(textJson_tem[key]);
							}
						}else if(key =='ed21' || key =='ed22'){
							if(textJson_tem[key] == 'hide'){
								$('#swi4_cont_1').addClass('divHide');
								$('#addBox3').removeClass('divHide');
							}else{
								$($('#'+key+'').selector).html(textJson_tem[key]);
							}
						}else if(key =='ed23' || key =='ed24'){
							if(textJson_tem[key] == 'hide'){
								$('#swi4_cont_2').addClass('divHide');
								$('#addBox4').removeClass('divHide');
							}else{
								$($('#'+key+'').selector).html(textJson_tem[key]);
							}
						}else if(key =='ed25' || key =='ed26'){
							if(textJson_tem[key] == 'hide'){
								$('#swi4_cont_3').addClass('divHide');
								$('#addBox5').removeClass('divHide');
							}else{
								$($('#'+key+'').selector).html(textJson_tem[key]);
							}
						}
						else{
							 $($('#'+key+'').selector).html(textJson_tem[key]);
						}
					}


					
					//渲染自定义图片
					//自定义图片的渲染
					$.each(textJson_tem['imgArr'],function(i){
						if( (i+1) == 1){
							if(textJson_tem['imgArr'][i] == 'hide'){
								$('#swi2_cont_1').addClass('divHide');
								$('#addBox1').removeClass('divHide');
							}else{
								$('#edimg'+(i+1)+'').attr('src',textJson_tem['imgArr'][i]);
							}
						}else if( (i+1) == 2){
							if(textJson_tem['imgArr'][i] == 'hide'){
								$('#swi2_cont_2').addClass('divHide');
								$('#addBox2').removeClass('divHide');
							}else{
								$('#edimg'+(i+1)+'').attr('src',textJson_tem['imgArr'][i]);
							}
						}else if( (i+1) == 4){
							if(textJson_tem['imgArr'][i] == 'hide'){ 
								$('#swi4_cont_3').addClass('divHide');
								$('#addBox5').removeClass('divHide');
							}else{
								$('#edimg'+(i+1)+'').attr('src',textJson_tem['imgArr'][i]);
							}
						}else{
							$('#edimg'+(i+1)+'').attr('src',textJson_tem['imgArr'][i]);
						}
					});



					//判断是否从音乐页面跳转回来
					if(sessionStorage.getItem('bgdMusic') == null){
						//渲染背景音乐
						bgdMusic = textJson_tem['bgdMusic'];
					}else{
						//渲染背景音乐
						bgdMusic = sessionStorage.getItem('bgdMusic');
					}

					//机构名称赋值
					organization_name = textJson_tem['organization_name'];

					//分享描述的赋值
					shareRemark = organization_name != '' ? organization_name+'祝大家寒假快乐':'小蜜蜂琴行祝大家寒假快乐！' ;

					//坐标赋值
					positionX = textJson_tem['positionX'];
					positionY = textJson_tem['positionY'];

					//定位地图
					map61.init(positionX,positionY);
					

				}//else结尾

			}else{
				//预览返回
				var textJson_pre  = <{$user_preview_json}>;
				console.log("修改=$user_preview_json======"+JSON.stringify(textJson_pre));
				

				//渲染文字
				for(var key in textJson_pre.json){
					if(key =='ed14' || key =='ed15'){
						if(textJson_pre.json[key] == 'hide'){
							$('#swi2_cont_1').addClass('divHide');
							$('#addBox1').removeClass('divHide');
						}else{
							$($('#'+key+'').selector).html(textJson_pre.json[key]);
						}
					}else if(key =='ed16' || key =='ed17'){
						if(textJson_pre.json[key] == 'hide'){
							$('#swi2_cont_2').addClass('divHide');
							$('#addBox2').removeClass('divHide');
						}else{
							$($('#'+key+'').selector).html(textJson_pre.json[key]);
						}
					}else if(key =='ed21' || key =='ed22'){
						if(textJson_pre.json[key] == 'hide'){
							$('#swi4_cont_1').addClass('divHide');
							$('#addBox3').removeClass('divHide');
						}else{
							$($('#'+key+'').selector).html(textJson_pre.json[key]);
						}
					}else if(key =='ed23' || key =='ed24'){
						if(textJson_pre.json[key] == 'hide'){
							$('#swi4_cont_2').addClass('divHide');
							$('#addBox4').removeClass('divHide');
						}else{
							$($('#'+key+'').selector).html(textJson_pre.json[key]);
						}
					}else if(key =='ed25' || key =='ed26'){
						if(textJson_pre.json[key] == 'hide'){
							$('#swi4_cont_3').addClass('divHide');
							$('#addBox5').removeClass('divHide');
						}else{
							$($('#'+key+'').selector).html(textJson_pre.json[key]);
						}
					}
					else{
						 $($('#'+key+'').selector).html(textJson_pre.json[key]);
					}
				}


				
				//渲染自定义图片
				//自定义图片的渲染
				$.each(textJson_pre.json['imgArr'],function(i){
					if( (i+1) == 1){
						if(textJson_pre.json['imgArr'][i] == 'hide'){
							$('#swi2_cont_1').addClass('divHide');
							$('#addBox1').removeClass('divHide');
						}else{
							$('#edimg'+(i+1)+'').attr('src',textJson_pre.json['imgArr'][i]);
						}
					}else if( (i+1) == 2){
						if(textJson_pre.json['imgArr'][i] == 'hide'){
							$('#swi2_cont_2').addClass('divHide');
							$('#addBox2').removeClass('divHide');
						}else{
							$('#edimg'+(i+1)+'').attr('src',textJson_pre.json['imgArr'][i]);
						}
					}else if( (i+1) == 4){
						if(textJson_pre.json['imgArr'][i] == 'hide'){ 
							$('#swi4_cont_3').addClass('divHide');
							$('#addBox5').removeClass('divHide');
						}else{
							$('#edimg'+(i+1)+'').attr('src',textJson_pre.json['imgArr'][i]);
						}
					}else{
						$('#edimg'+(i+1)+'').attr('src',textJson_pre.json['imgArr'][i]);
					}
				});




				//判断是否从音乐页面跳转回来
				if(sessionStorage.getItem('bgdMusic') == null){
					//渲染背景音乐
					bgdMusic = textJson_pre.json['bgdMusic'];
				}else{
					//渲染背景音乐
					bgdMusic = sessionStorage.getItem('bgdMusic');
				}

				//机构名称赋值
				organization_name = textJson_pre.json['organization_name'];

				//分享描述的赋值
				shareRemark = organization_name != '' ? organization_name+'祝大家寒假快乐':'小蜜蜂琴行祝大家寒假快乐！' ;


				//坐标赋值
				positionX = textJson_pre.json['positionX'];
				positionY = textJson_pre.json['positionY'];

				//定位地图
				map61.init(positionX,positionY);
				


			}//else结尾




		}); //document结尾




		//获取文字和图片的函数
		function submitFun() {
			//获取文字
			for(var i = 1; i <= 29; i++) {
				if(i == 14 || i == 15) {
					//判断是否添加框是否有divHide
					if($('#addBox1').hasClass('divHide') == true) {
						textJson['ed' + i] = $('#ed' + i).html();
					}else{
						textJson['ed' + i] = 'hide';
					}
				}else if(i == 16 || i == 17) {
					//判断是否存在i标签
					if($('#addBox2').hasClass('divHide') == true) {
						textJson['ed' + i] = $('#ed' + i).html();
					}else{
						textJson['ed' + i] = 'hide';
					}
				}else if(i == 21 || i == 22) {
					//判断是否存在i标签
					if($('#addBox3').hasClass('divHide') == true) {
						textJson['ed' + i] = $('#ed' + i).html();
					}else{
						textJson['ed' + i] = 'hide';
					}
				}else if(i == 23 || i == 24) {
					//判断是否存在i标签
					if($('#addBox4').hasClass('divHide') == true) {
						textJson['ed' + i] = $('#ed' + i).html();
					}else{
						textJson['ed' + i] = 'hide';
					}
				}else if(i == 25 || i == 26) {
					//判断是否存在i标签
					if($('#addBox5').hasClass('divHide') == true) {
						textJson['ed' + i] = $('#ed' + i).html();
					}else{
						textJson['ed' + i] = 'hide';
					}
				}else{
					textJson['ed' + i] = $('#ed' + i).html();
				}
			}


			//获取图片
			for(var i = 1;i <= 4;i++){
				if(i == 1){
					//判断是否存在i标签
					if($('#addBox1').hasClass('divHide') == true) {
						imgArr[i - 1] = $('#edimg' + i).attr('src');
					} else {
						imgArr[i - 1] = 'hide';
					}
				}else if( i == 2){
					//判断是否存在i标签
					if($('#addBox2').hasClass('divHide') == true) {
						imgArr[i - 1] = $('#edimg' + i).attr('src');
					} else {
						imgArr[i - 1] = 'hide';
					}
				}else if(i == 4){
					//判断是否存在i标签
					if($('#addBox5').hasClass('divHide') == true) {
						imgArr[i - 1] = $('#edimg' + i).attr('src');
					} else {
						imgArr[i - 1] = 'hide';
					}
				}else{
					imgArr[i - 1] = $('#edimg' + i).attr('src');
				}
			}




			//保存之前先将base64的图片转成url
			$.each(imgArr,function(i){
				//判断是否存在base64的图片
				if(imgArr[i].indexOf('base64') != -1){
					$.ajax({
						type: "post",
						url: "http://<{$sys_domain}>/modules/wap_user_tpl_edit/post.php?class=update_image",
						type: "POST",
						dataType: "json",
						async:false,
						data: {
							userid: '<{$template_user_id}>',
							image_base64: imgArr[i],
						},
						success: function(data) {
							imgArr[i] = data.data.url;
						}
					});
				}
			});


			//将自定义图片存进textJson
			textJson['imgArr'] = imgArr;

			//将背景音乐存进textJson
			textJson['bgdMusic'] = bgdMusic;

			//坐标添加进textJson里
			textJson['positionX'] = positionX;
			textJson['positionY'] = positionY;

			//将机构名称添加进json
			textJson['organization_name'] = organization_name;
		}




		$(document).ready(function(){
			
			//去除地图logo
			$("#container_61").bind("DOMNodeInserted",function(e){
	            var tempCount = 0;
			    $("#container_61 .smnoprint").siblings().each(function(){
			    	tempCount++;
			    	if(tempCount==2||tempCount==3){
			    		$(this).remove();
			    	}
			    });
			});
			
			//给活动开始时间戳一个默认值
			var myDate = new Date(); 
			var stringTime;
			if($('#ed9').text().length == 1){
			 	if ($('#ed10').text().length == 2) {
			 		stringTime = myDate.getFullYear()+"-0"+$('#ed9').text()+"-"+$('#ed10').text();
			 	}else{
			 		stringTime = myDate.getFullYear()+"-0"+$('#ed9').text()+"-0"+$('#ed10').text();
			 	}
			}else{
				if ($('#ed10').text().length == 2) {
			 		stringTime = myDate.getFullYear()+"-"+$('#ed9').text()+"-"+$('#ed10').text();
			 	}else{
			 		stringTime = myDate.getFullYear()+"-"+$('#ed9').text()+"-0"+$('#ed10').text();
			 	}
				
			}
			var timestamp2 = Date.parse(new Date(stringTime));
			timestampStart = timestamp2 / 1000;

			// alert(timestampStart+"开始时间戳");


			//日历
			//日期触发函数
			var now = new Date(),
				max = new Date(now.getFullYear(), now.getMonth(), now.getDate());
			var currYear = now.getFullYear();
			var currMonth = now.getMonth();
			var currDay = now.getDate();

			$('#date_input_1').mobiscroll().date({
				seconds: false,
				ampm: false,
				lang: 'zh',
				dateOrder: 'yymd',
				theme: 'android-ics light',
				startYear: currYear, //开始年份
				setText: '确定',
				cancelText: '取消',
				display: 'bottom',
				onSelect: function(valueText, inst) {
					console.log(inst.val);


					// 获取某个时间格式的时间戳
					var stringTime = inst.val;
					var timestamp2 = Date.parse(new Date(stringTime));
					timestampStart = timestamp2 / 1000;
					//2014-07-10 10:21:12的时间戳为：1404958872 
					console.log(stringTime + "的时间戳为：" + timestampStart);



					var newYear = inst.temp[0]; //年
					var newMonth = inst.temp[1]; //月
					var newDay = inst.temp[2]; //日

					var newWeek = new Date(newYear, newMonth, (newDay));
					var weekArray = new Array("星期日", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六");
					var week = weekArray[newWeek.getDay()]; // 星期

					$('#ed9').html(parseInt(newMonth) + 1);
					$('#ed10').html(newDay);
				}
			});



			$('#date_input_2').mobiscroll().date({
				seconds: false,
				ampm: false,
				lang: 'zh',
				dateOrder: 'yymd',
				theme: 'android-ics light',
				startYear: currYear, //开始年份
				setText: '确定',
				cancelText: '取消',
				display: 'bottom',
				onSelect: function(valueText, inst) {


					// 获取某个时间格式的时间戳
					var stringTime = inst.val;
					var timestamp2 = Date.parse(new Date(stringTime));
					timestampStop = timestamp2 / 1000;
					//2014-07-10 10:21:12的时间戳为：1404958872 
					console.log(stringTime + "的时间戳为：" + timestampStop);

					//结束时间不能小于开始时间
					if(timestampStop > timestampStart){
						var newYear = inst.temp[0]; //年
						var newMonth = inst.temp[1]; //月
						var newDay = inst.temp[2]; //日

						var newWeek = new Date(newYear, newMonth, (newDay));
						var weekArray = new Array("星期日", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六");
						var week = weekArray[newWeek.getDay()]; // 星期

						$('#ed11').html(parseInt(newMonth) + 1);
						$('#ed12').html(newDay);
					}else{
						alert("活动结束时间不能小于活动开始时间！");
					}


					
				}
			});
			
			
			
			
			
		});

		var swiper = new Swiper('.swiper-container', {
			direction: 'vertical',
			pagination: {
				el: '.swiper-pagination',
				clickable: true,
			},
			onTouchStart: function(swiper, even) {
				swiper.params.allowSwipeToPrev = true;
				swiper.params.allowSwipeToNext = true;
				if($("#swi1").hasClass("swiper-slide-active")) { swiper.params.allowSwipeToPrev = false; };
			},
			onSlideChangeStart: function(swiper) {
				//改变页码
				var pageNum = parseInt(swiper.activeIndex + 1);
				$('#pageNum').find('span').html(pageNum);
			},
			onInit: function(swiper) {},
			onTouchEnd: function(swiper) {
				//改变页码
				var pageNum = parseInt(swiper.activeIndex + 1);
				$('#pageNum').find('span').html(pageNum);
			},
			onInit: function(swiper) {

			},
			onTouchMove: function(swiper) {
				$(".slider").removeClass("on");
			},
		});
		
		
		
		//编辑框触发函数
		function edit_onFuntion(faThis, allLength) {
			var oldText = faThis.text();

			//如果是电话就显示input标签框，隐藏textare
			if(faThis[0].id == 'ed28'){
				$('#edit_dialog').removeClass('divHide');
				$('#edit_layer').removeClass('divHide');
				$('#edit_length').find('span:nth-child(1)').html(oldText.length);
				$('#edit_length').find('span:nth-child(2)').html(allLength);
				//显示input
				$('#edit_number_input').removeClass('divHide');
				$('#edit_input_layer').removeClass('divHide');
				$('#edit_number_input').attr('maxlength', allLength);
				$('#edit_number_input').val(oldText);
				$('#edit_dialog').find('ul').append('<li style="display:none;">' + faThis.attr("id") + '</li>');
			}else if(faThis[0].id == 'swi1_cont_five'){
				var allText = "";
				for(var i = 1;i <= 5; i++){
					allText += $('#ed'+i).text();
				}
				$('#edit_dialog').removeClass('divHide');
				$('#edit_layer').removeClass('divHide');
				$('#edit_length').find('span:nth-child(1)').html(allText.length);
				$('#edit_length').find('span:nth-child(2)').html(allLength);
				$('#edit_dialog').find('textarea').attr('maxlength', allLength);
				$('#edit_dialog').find('textarea').val(allText);
				$('#edit_dialog').find('ul').append('<li style="display:none;">' + faThis.attr("id") + '</li>');
			}else if(faThis[0].id == 'swi1_cont_2'){
				var allText = "";
				for(var i = 6;i <= 8; i++){
					allText += $('#ed'+i).text();
				}
				$('#edit_dialog').removeClass('divHide');
				$('#edit_layer').removeClass('divHide');
				$('#edit_length').find('span:nth-child(1)').html(allText.length);
				$('#edit_length').find('span:nth-child(2)').html(allLength);
				$('#edit_dialog').find('textarea').attr('maxlength', allLength);
				$('#edit_dialog').find('textarea').val(allText);
				$('#edit_dialog').find('ul').append('<li style="display:none;">' + faThis.attr("id") + '</li>');
			}
			else{
				//因为描述太长导致确定按钮变形
				if(faThis[0].id == 'ed19'){
					$('#edit_dialog').find('li:nth-child(2)').css('margin','0 37%');
				}else{
					$('#edit_dialog').find('li:nth-child(2)').css('margin','0 39%');
				}
				$('#edit_dialog').removeClass('divHide');
				$('#edit_layer').removeClass('divHide');
				$('#edit_number_input').addClass('divHide');
				$('#edit_input_layer').addClass('divHide');
				$('#edit_length').find('span:nth-child(1)').html(oldText.length);
				$('#edit_length').find('span:nth-child(2)').html(allLength);
				$('#edit_dialog').find('textarea').attr('maxlength', allLength);
				$('#edit_dialog').find('textarea').val(oldText);
				$('#edit_dialog').find('ul').append('<li style="display:none;">' + faThis.attr("id") + '</li>');
			}
			
			
		}

		//点击编辑框的取消函数
		function edit_qxFun() {
			$('#edit_dialog').addClass('divHide');
			$('#edit_layer').addClass('divHide');
			//删除新建的li
			$('#edit_dialog').find('li:nth-child(4)').remove();
		}

		//点击编辑框的确定函数
		function edit_qdFun() {
			//修改后的文本
			var textVal = $('#edit_dialog').find('textarea').val();
			//修改的Id
			var Pid = $('#edit_dialog').find('li:nth-child(4)').text();

			//判断电话号码
			if(Pid == "ed28") {
				var textVal2 = $('#edit_number_input').val();
				var a = checkphone(textVal2);
				if(a == true) {
					$('#' + Pid + '').text(textVal2);

					$('#edit_dialog').addClass('divHide');
					$('#edit_layer').addClass('divHide');
					//删除新建的li
					$('#edit_dialog').find('li:nth-child(4)').remove();
				}
			}else if(Pid == "swi1_cont_five"){
				//1.2.3.4.5的赋值
				var addNum = 0;
				for(var i = 1;i <= 5; i++){
//					console.log(textVal.substring(addNum,i));
					$('#ed'+i).text(textVal.substring(addNum,i));
					addNum = i;
				}
				$('#edit_dialog').addClass('divHide');
				$('#edit_layer').addClass('divHide');
				//删除新建的li
				$('#edit_dialog').find('li:nth-child(4)').remove();
			}else if(Pid == "swi1_cont_2"){
				//6.7.8的赋值
				$('#ed6').text(textVal.substring(0,17));
				$('#ed7').text(textVal.substring(17,39));
				$('#ed8').text(textVal.substring(39,55));
				$('#edit_dialog').addClass('divHide');
				$('#edit_layer').addClass('divHide');
				//删除新建的li
				$('#edit_dialog').find('li:nth-child(4)').remove();
			}else {
				$('#' + Pid + '').text(textVal);
				$('#edit_dialog').addClass('divHide');
				$('#edit_layer').addClass('divHide');
				//删除新建的li
				$('#edit_dialog').find('li:nth-child(4)').remove();
			}
		}

		$(function() {
			//监听编辑框输入长度
			$('#edit_dialog').find('textarea').bind('input propertychange', function() {
				$('#edit_length').find('span:nth-child(1)').html($(this).val().length);
			});

		});

		//电话号码检查函数
		function checkphone(a) {
			var phone = a;
			var isPhone = /^1[34578]\d{9}$/;
			var isMob = /^0(([1,2]\d)|([3-9]\d{2}))\d{7,8}$/;
			var value = a.trim();
			if(/^1[34578]\d{9}$/.test(value)) {
				return true;
			} else if(isMob.test(value)) {
				if(phone.split("")[0] == 0) {
					if(phone.split("")[1] == 2) {
						var a1 = phone.substr(0, 3);
						var a2 = phone.substr(3, 10);
					} else {
						var a1 = phone.substr(0, 4);
						var a2 = phone.substr(4, 11);
					};
				};
				return true;
			} else {
				alert("请输入正确的手机号码或固定电话");
				return false;
			};

		};
		
		
		//课程删除、添加按钮
		function closeFun(faFirst, faTwo) {
			$(faFirst).addClass('divHide');
			$(faTwo).removeClass('divHide');
		}

		function addFun(faFirst, faTwo) {
			$(faFirst).removeClass('divHide');
			$(faTwo).addClass('divHide');
		}
		
	</script>

</html>