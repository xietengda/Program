<!DOCTYPE html>
<html>

	<head>
		<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0" />
		<meta charset="UTF-8">
		<title>寒假招生</title>
		<link rel="stylesheet" href="http://qhb.lelego.net.cn/upload/tpl_file/public/module_swiper.min.css" />
		<link rel="stylesheet" href="http://qhb.lelego.net.cn/plugins/layui/css/layui.css">
		<link rel="stylesheet" href="<{$template_path}>/winter_vacation01.css" />
		<style>
			.swi3_cont_img_layer {
				display: inline-block;
				width: 2.2rem;
				height: 2.3rem;
				border-radius: 0.1rem;
				background-color: black;
				opacity: 0.3;
				position: absolute;
				z-index: 3;
				margin-top: -1%;
			}
			

		</style>
	</head>

	<body>

		<!--左上角保存和编辑-->
		<div id="prevSAndE">
			<ul>
				<li id="prevSave" onClick='saveDialog()' class='divHide'><span></span><span>保存</span></li>
				<li id="prevEdit" onClick='LeftEditFun()' class='divHide'><span></span><span>编辑</span></li>
				<li id="prevMiusc">
					<div id="preMiusc_bgm">
						<span></span>
						<span id='preMiusc_bgm1' onClick='playPause()'></span>
					</div>
					<audio src="" style=" display:none" id='preMiuscAudio' controls loop autoplay></audio>
				</li>
			</ul>
		</div>
		<!--左上角保存和编辑-->



		<div id="father">
			<div class="swiper-container text_swiper">
				<div class="swiper-wrapper">
					<div class="swiper-slide" id="swi1">
						<div id="swi1_title">
							<img src="<{$template_path}>/home_title@2x.png" />
						</div>
						<div id="swi1_cont_1">
							<span id="ed1">寒期优惠招生</span><span>|</span><span id="ed2">课程免费赠送</span>
						</div>
						<div id="swi1_cont_2">
							<p>活动时间：<span id="ed3">1</span>月<span id="ed4">15</span>日至<span id="ed5">2</span>月<span id="ed6">30</span>日</p>
						</div>
						<div id="swi1_cont_3">
							<p id="ed7">新老学员凡关注小蜜蜂琴行公众号</p>
						</div>
						<div id="swi1_cont_4">
							<p id="ed8">转发本链接到朋友圈即可享受以下优惠大礼包</p>
						</div>
					</div>
					<div class="swiper-slide swi_bgi" id="swi2">
						<div class="swi_title">
							<p id="ed9">小蜜蜂琴行</p>
						</div>
						<div id="swi2_cont_img">
							<img id="edimg1" src="<{$template_path}>/pic_mechanism@2x.png" />
						</div>
						<div id="swi2_cont_cont">
							<p id="ed10">小蜜蜂琴行成立于2015年，是子昊专业钢琴音乐教育旗下直营琴行，拥有15年行业经验。同时也是高明首家引进智能钢琴集体课的琴行，行内设备先进，师资雄厚。小蜜蜂琴行自成立以来，广受家长和学生好评。</p>
						</div>

					</div>



					<div class="swiper-slide swi_bgi" id="swi3">
						<div class="swi_title">
							<p id="ed11">精品课程介绍</p>
						</div>

						<div id="swi3_cont_swiper">
							<div class="swiper-container gallery-thumbs">
						        <div class="swiper-wrapper">
						            <!-- <div class="swiper-slide gallery_top_img">
						            	<img id="edimg2" src="<{$template_path}>/pic_seleted@2x.png" />
						            </div>
						            <div class="swiper-slide gallery_top_img">
						            	<img id="edimg3" src="<{$template_path}>/pic_seleted@2x.png" />
						            </div>
						            <div class="swiper-slide gallery_top_img">
						            	<img id="edimg4" src="<{$template_path}>/pic_seleted@2x.png" />
						            </div> -->
						        </div>
						    </div>
						    <div class="swiper-container gallery-top">
						        <div class="swiper-wrapper">
						            <!-- <div class="swiper-slide gallery_thumbs_cont">
						            	<div id="swi3_cont_cont_1">
											<p id="ed12">《钢琴启蒙班》</p>
											<p>— — — — — — — — — — — — — — — — —</p>
											<p id="ed13">启蒙班集体课，适合4-7岁的孩子，通过动画故事进行知识讲解通俗易懂，引人入胜。</p>
										</div>
						            </div>
						            <div class="swiper-slide gallery_thumbs_cont">
						            	<div id="swi3_cont_cont_2 ">
											<p id="ed14">《一对一钢琴班》</p>
											<p>— — — — — — — — — — — — — — — — —</p>
											<p id="ed15">目前最高效的钢琴授课方式，老师根据学生的情况制定教学方案，让您的孩子进步神速。</p>
										</div>
						            </div>
						            <div class="swiper-slide gallery_thumbs_cont">
						            	<div id="swi3_cont_cont_3">
											<p id="ed16">《音基集体课》</p>
											<p>— — — — — — — — — — — — — — — — —</p>
											<p id="ed17">特色课程，音乐基础是学音乐必修的知识，就像学英语一样，音标学好了，英语才会学得好。</p>
										</div>
						            </div> -->
						        </div>
						    </div>
						</div>
					</div>





					<div class="swiper-slide swi_bgi" id="swi4">
						<div class="swi_title">
							<p id="ed18">现报名超划算</p>
						</div>
						<div id="swi4_cont_1">
							<div  id="swi4_cont_one_1">
								<img  id="zeng" src="<{$template_path}>/icon_list_gift@2x.png">
								<span id="ed19">报名即赠送540元课程</span>
							</div>
							<div  id="swi4_cont_one_2">
								<img id="zhe" src="<{$template_path}>/icon_list_discount@2x.png">
								<span id="ed20">学期、学年报班享折上折</span>
							</div>
							<div  id="swi4_cont_one_3">
								<img  id="shou" src="<{$template_path}>/icon_list_first@2x.png">
								<span id="ed21">首次报名即送开学大礼包</span>
							</div>
						</div>
						<div id="swi4_cont_hr">
							<p>— — — — — — — — — — — — — — — — — —</p>
						</div>
						<div id="swi4_cont_2">
							<div id="swi4_cont_two_1">
								<span><img src="<{$template_path}>/icon_gift@2x.png" /> </span>
								<span id="ed22">转发此链接到朋友圈，报满一期20节，即送2节课程！</span>
							</div>
							<div id="swi4_cont_two_2">
								<span><img src="<{$template_path}>/icon_gift@2x.png" /> </span>
								<span id="ed23">老学员介绍新学员报名成功双方即可免费获得2节课程！</span>
							</div>
							<div id="swi4_cont_two_3">
								<span><img src="<{$template_path}>/icon_gift@2x.png" /> </span>
								<span id="ed24">新学员报满一期20节，即可获得子昊专业教材一份。</span>
							</div>
						</div>
						<div id="swi4_footer">
							<p id="ed25">注：以上礼包可同时领取，钢琴班报读一期20节课即可参加此次活动~</p>
						</div>
					</div>
					<div class="swiper-slide swi_bgi" id="swi5">
						<div class="swi_title">
							<p id="ed26">联系方式</p>
						</div>
						<div id="swi5_cont_1">
							<p>联系电话：<a href="javascript:void(0)"><span id="ed27">075788889031</span></a></p>
							<p>联系地址：<span id="ed28">佛山市高明区跃华路小蜜蜂琴行（永安花园对面）</span></p>
						</div>
						<div id="swi5_map">
							<div class=" Frame_wap_user_organization_edit" id="Frame61">
								<form action="" method="post" id="Frame60_form_1">
									<input name="id" type="hidden" value="60" />
									<input name="oid" type="hidden" value="1" />
									<div class="main pt10">
										<input type="hidden" name="lat" /> <input type="hidden" name="lng" />
										<div id="container_61" class="map" style="height:3.6rem; z-index:99"></div>
										<div class="dno" id="Address_list"></div>
									</div>
								</form>
							</div>
						</div>
						<div id="swi5_footer">
							<ul>
								<li id="zixun">
									<a href="javascript:void(0)">我要咨询</a>
								</li>
								<li onclick="sign_upFun()">我要报名</li>
							</ul>
						</div>
					</div>
					<!-- Add Pagination -->
					<div class="swiper-pagination"></div>
				</div>
				<!--底部光标-->
				<div id="pageDiv">
					<!--页数-->
					<div id="pageNum"><span>1</span>/5</div>
				</div>
			</div>


			<!--举报弹框-->
			<!--举报-->
			<div class="hide_all"></div>
			<div class="jubao">
				<span class="close_jibao" onClick="close_jibao()"><img src="http://qhb.lelego.net.cn/upload/tpl_file/public/module_close.png"/></span>
				<form class="layui-form" action="">
					<h2>请选择举报原因</h2>
					<div class="layui-form-item">
						<div class="layui-input-block" id="jubaoBox">
							<div class="div1"  onClick="other1()"><input type="radio" name="reason" class="reason1" value="1" title="恶意营销、虚假传播"></div>
							<div class="div2"  onClick="other1()"><input type="radio" name="reason" class="reason2" value="2" title="侵权"></div>
							<div class="div3"  onClick="other1()"><input type="radio" name="reason" class="reason3" value="3" title="色情、赌博、毒品"></div>
							<div class="div4"  onClick="other1()"><input type="radio" name="reason" class="reason4" value="4" title="违反国家政策和法律"></div>
							<div class="div5" onClick="other()"><input type="radio" name="reason" value="5" title="其他原因" class="reason5"></div>
							<textarea placeholder="请输入其他原因" class="layui-textarea other"></textarea>
							<input type="button" class="layui-btn" lay-submit="" lay-filter="demo1" onclick="return check()" value="立即提交" />
						</div>

					</div>
				</form>
			</div>

			<!--底部举报及关注-->
			<!--举报及关注-->
			<div id="report_div" class='divHide'>
				<i></i>
				<span onClick='jubaoShow()'>举报</span>
				<span>技术支持by<a href="http://qhb.lelego.net.cn/wap.php?id=44&tpl_id=3&file=Propaganda.tpl"/>琴行宝</a></span>
			</div>


			<!--图片裁剪框-->
			<div class="caiBox">
				<h2 style="width:100%; text-align:center; position:fixed; top:0; left:0; line-height:0.6rem; font-size:0.4rem;color:#4eaf7a; z-index:999999999">双指旋转和双指缩放</h2>
				<button id="clipBtn">确定裁剪</button>
				<button id="clipBtn1" onClick="Close()">取消</button>
				<div id="clipArea"></div>
				<canvas id="myCanvas" style=" display:none"></canvas>
			</div>
			<!--图片裁剪框-->


	</body>
	<script type="text/javascript" src="https://cdn.bootcss.com/jquery/2.2.0/jquery.min.js"></script>
	<script type="text/javascript" src="http://qhb.lelego.net.cn/upload/tpl_file/public/adaptive.js"></script>
	<script type="text/javascript" src="http://qhb.lelego.net.cn/upload/tpl_file/public/module_swiper.js"></script>
	<!--地图-->
	<script charset="utf-8" src="http://map.qq.com/api/js?v=2.exp&libraries=convertor"></script>
	<script type="text/javascript" src="https://3gimg.qq.com/lightmap/components/geolocation/geolocation.min.js"></script>
	<script type="text/javascript" src="http://qhb.lelego.net.cn/upload/tpl_file/public/module_wap_qq_map.js"></script>
	<script src="http://qhb.lelego.net.cn/plugins/layui/layui.js"></script>
	<!--图片插件-->
	<script src="http://qhb.lelego.net.cn/js/LocalResizeIMG/patch/mobileBUGFix.mini.js"></script>
	<script type="text/javascript" src="http://qhb.lelego.net.cn/upload/tpl_file/public/module_LocalResizeIMG.js"></script>
	<!--图片裁剪-->
	<script type="text/javascript" src="http://qhb.lelego.net.cn/upload/tpl_file/public/jquery.photoClip.js"></script>
	<script type="text/javascript" src="http://qhb.lelego.net.cn/upload/tpl_file/public/hammer.js"></script>
	<script type="text/javascript" src="http://qhb.lelego.net.cn/upload/tpl_file/public/iscroll-zoom.js"></script>
	<script type="text/javascript" src="http://qhb.lelego.net.cn/upload/tpl_file/public/sonic.js"></script>
	<script>

		//文字图片保存Json
		var textJson = {};
		//位置坐标x
		var positionX;
		//位置坐标Y
		var positionY;
		//自定义图片
		var imgArr = new Array();
		//背景音乐(默认)
		var bgdMusic;
		//课程选项
		var ClassOption = new Array();
		//分享封面图片
		var tal_shareBgi = new Array();
		//小地图
		var map61 = new wap_qq_map('container_61');



		
		//切换课程函数
		function changeClassFun(faThis) {
			var pIndex = faThis.parent().attr('value');
			faThis.remove();
			for(var i = 1; i <= 3; i++) {
				//选中的
				if(i != pIndex) {
					//判断是否已经存在i标签
					if($('#swi3_cont_img_' + i).find('i').length == 0 && $('#swi3_cont_img_' + i).hasClass('divHide') == false) {
						$('#swi3_cont_img_' + i).prepend('<i class="swi3_cont_img_layer" onclick="changeClassFun($(this))"></i>');
					}
				}
			}
			$('#swi3_cont_cont_' + pIndex).removeClass('divHide').siblings().addClass('divHide');
		}

		//页码淡入淡出
		function pageNum_inOrOut() {
			$('#pageDiv').fadeIn('slow');
			setTimeout(function() {
				$('#pageDiv').fadeOut("slow");
			}, 1000);
		}


		


		var swiper = new Swiper('.text_swiper', {
			direction: 'vertical',
			pagination: {
				el: '.swiper-pagination',
				clickable: true,
			},
			onTouchStart: function(swiper, even) {
				swiper.params.allowSwipeToPrev = true;
				swiper.params.allowSwipeToNext = true;
				if($("#swi1").hasClass("swiper-slide-active")) { swiper.params.allowSwipeToPrev = false; };
			},
			onSlideChangeStart: function(swiper) {
				//改变页码
				var pageNum = parseInt(swiper.activeIndex + 1);
				$('#pageNum').find('span').html(pageNum);
				pageNum_inOrOut();
				//底部的举报
				if(pageNum == 5) {
					$('#report_div').fadeIn(500);
				} else {
					$('#report_div').fadeOut(1000);
				}
			},
			onTouchEnd: function(swiper) {
				//改变页码
				var pageNum = parseInt(swiper.activeIndex + 1);
				$('#pageNum').find('span').html(pageNum);
				pageNum_inOrOut();
			},
			onInit: function(swiper) {
			
			},
			onTouchMove: function(swiper) {
				$(".slider").removeClass("on");
			},
		});


		 

		$(function() {
			//页码淡入淡出
			setTimeout(function() {
				$('#pageDiv').fadeOut("slow");
			}, 1000);



			//去除地图logo
			$("#container_61").bind("DOMNodeInserted",function(e){
	            var tempCount = 0;
			    $("#container_61 .smnoprint").siblings().each(function(){
			    	tempCount++;
			    	if(tempCount==2||tempCount==3){
			    		$(this).remove();
			    	}
			    });
			});


			//获取从编辑页面数据
			textJson = <{$user_template_json}>;
			console.log(textJson);

			var galleryThumbs;//上面滑动silder
			var galleryTop;//下面滑动silder


			//渲染页面↓
			//渲染文字
			for(var key in textJson){
				if(key =='ed12'){
					if(textJson[key] != 'hide'){
						var tamp = '<div class="swiper-slide swiper-slide-active gallery_thumbs_cont">';
							tamp += '<div id="swi3_cont_cont_1">';
							tamp += '<p id="ed12">'+textJson['ed12']+'</p>';
							tamp += '<p>— — — — — — — — — — — — — — — — —</p>';
							tamp += '<p id="ed13">'+textJson['ed13']+'</p>';
							tamp += '</div>';
							tamp += '</div>';

						$('.gallery-top').find('.swiper-wrapper').append(tamp);

						//将课程名称添加进要在报名页面渲染的数组中
						ClassOption.push(textJson[key]);		
					}

				}else if(key =='ed14'){
					if(textJson[key] != 'hide'){
						var tamp = '<div class="swiper-slide swiper-slide-active gallery_thumbs_cont">';
							tamp += '<div id="swi3_cont_cont_1">';
							tamp += '<p id="ed14">'+textJson['ed14']+'</p>';
							tamp += '<p>— — — — — — — — — — — — — — — — —</p>';
							tamp += '<p id="ed15">'+textJson['ed15']+'</p>';
							tamp += '</div>';
							tamp += '</div>';

						$('.gallery-top').find('.swiper-wrapper').append(tamp);

						//将课程名称添加进要在报名页面渲染的数组中
						ClassOption.push(textJson[key]);	
					}
				}else if(key =='ed16'){
					if(textJson[key] != 'hide'){
						var tamp = '<div class="swiper-slide swiper-slide-active gallery_thumbs_cont">';
							tamp += '<div id="swi3_cont_cont_1">';
							tamp += '<p id="ed16">'+textJson['ed16']+'</p>';
							tamp += '<p>— — — — — — — — — — — — — — — — —</p>';
							tamp += '<p id="ed17">'+textJson['ed17']+'</p>';
							tamp += '</div>';
							tamp += '</div>';

						$('.gallery-top').find('.swiper-wrapper').append(tamp);

						//将课程名称添加进要在报名页面渲染的数组中
						ClassOption.push(textJson[key]);	
					}
				}else if(key == 'ed19'){
					if(textJson[key] == 'hide'){
						$('#swi4_cont_one_1').addClass('divHide');
					}else{
						$($('#'+key+'').selector).html(textJson[key]);
					}
				}else if(key == 'ed20'){
					if(textJson[key] == 'hide'){
						$('#swi4_cont_one_2').addClass('divHide');
					}else{
						$($('#'+key+'').selector).html(textJson[key]); 
					}
				}else if(key == 'ed21'){
					if(textJson[key] == 'hide'){
						$('#swi4_cont_one_3').addClass('divHide');
					}else{
						$($('#'+key+'').selector).html(textJson[key]);
					}
				}else if(key == 'ed22'){
					if(textJson[key] == 'hide'){
						$('#swi4_cont_two_1').addClass('divHide');
					}else{
						$($('#'+key+'').selector).html(textJson[key]);
					}
				}else if(key == 'ed23'){
					if(textJson[key] == 'hide'){
						$('#swi4_cont_two_2').addClass('divHide');
					}else{
						$($('#'+key+'').selector).html(textJson[key]);
					}
				}else if(key == 'ed24'){
					if(textJson[key] == 'hide'){
						$('#swi4_cont_two_3').addClass('divHide');
					}else{
						$($('#'+key+'').selector).html(textJson[key]);
					}
				}
				else if(key == 'ed27' && textJson[key] != 'hide'){
					//给电话加拨打链接
					$('#swi5_cont_1').find('a').attr('href','tel:'+textJson[key]);
				}else if(key == 'ed28'){
					//初始化左右滑动silder
					galleryTop = new Swiper('.gallery-top', {
				 	nextButton: '.swiper-button-next',
			        prevButton: '.swiper-button-prev',
			        spaceBetween: 0,
					observer:true,
				    });
				}
				else{
					 $($('#'+key+'').selector).html(textJson[key]);
				}
			}



			//自定义图片的渲染
			$.each(textJson['imgArr'],function(i){
				console.log("i=="+i);
				if( (i+1) == 2){
					if(textJson['imgArr'][i] != 'hide'){
						var temp = '<div class="swiper-slide swiper-slide-active gallery_top_img">';
							temp += '<img src="'+textJson['imgArr'][i]+'" />';
							temp += '</div>'
						$('.gallery-thumbs').find('.swiper-wrapper').append(temp);
					}
				}else if( (i+1) == 3){
					if(textJson['imgArr'][i] != 'hide'){
						var temp = '<div class="swiper-slide swiper-slide-active gallery_top_img">';
							temp += '<img src="'+textJson['imgArr'][i]+'" />';
							temp += '</div>'
						$('.gallery-thumbs').find('.swiper-wrapper').append(temp);
					}
				}else if( (i+1) == 4){
					if(textJson['imgArr'][i] != 'hide'){
						var temp = '<div class="swiper-slide swiper-slide-active gallery_top_img">';
							temp += '<img src="'+textJson['imgArr'][i]+'" />';
							temp += '</div>'
						$('.gallery-thumbs').find('.swiper-wrapper').append(temp);
					}

					galleryThumbs = new Swiper('.gallery-thumbs', {
				    	spaceBetween: 20,
				        centeredSlides: true,
				        slidesPerView: 'auto',
						observer:true,
						/*slidesOffsetAfter : -300,*/
				        touchRatio: 0.2,
				        slideToClickedSlide: true,
				        slidesOffsetBefore : -100,
					});

					galleryTop.params.control = galleryThumbs;
					galleryThumbs.params.control = galleryTop;
				}else{
					$('#edimg'+(i+1)+'').attr('src',textJson['imgArr'][i]);
				}
			});


			//显示第几个课程
			if($('#swi3_cont_img_1').hasClass('divHide') == true){
				if($('#swi3_cont_img_2').hasClass('divHide') == true){
					if($('#swi3_cont_img_3').hasClass('divHide') == true){

					}else{
						$('#swi3_cont_img_3 > i').remove();
						$('#swi3_cont_cont_3').removeClass('divHide');
					}
				}else{
					$('#swi3_cont_img_2 > i').remove();
					$('#swi3_cont_cont_2').removeClass('divHide');
				}
			}else{
				$('#swi3_cont_img_1 > i').remove();
				$('#swi3_cont_cont_1').removeClass('divHide');
			}


			//背景音乐渲染
			$('#preMiuscAudio').attr('src',textJson.bgdMusic);
			bgdMusic = textJson.bgdMusic;

			//音乐图标动起来
			$('#preMiusc_bgm').find('span:nth-child(2)').css('-webkit-animation','play_sate 4s infinite');

			//地图定位
			map61.init(textJson.positionX,textJson.positionY);


			


		});


		//一加载就获取判断是否是编辑页面跳转
		var changeImgUrl = window.location.href;
		var hrefUrl = changeImgUrl.split('?')[1];
		var hrefArr =hrefUrl.split('&');
		$.each(hrefArr,function(i){
			//判断是否显示左上角按钮
			if(hrefArr[i] == "a=1"){
				 sessionStorage.setItem('a','1');
				 $('#prevSave').removeClass('divHide');
				 $('#prevEdit').removeClass('divHide');
			}
			
		});

		//如果不是编辑，就给咨询加跳转链接 
		if(hrefArr.indexOf('a=1') == -1){
			$('#zixun').find('a').attr('href','<{$consulting_url}>');
			sessionStorage.setItem('a','0');
		}


		//点击我要报名函数
		function sign_upFun(){
			sessionStorage.setItem('ClassOption',ClassOption);
			window.location.href="http://qhb.lelego.net.cn?id=44&lang=cn&pid=<{$user_template_id}>&tpl_id=31&file=winter_vacation_sign_up.tpl";
		}


		//点击左上角编辑
		function LeftEditFun(){
			window.location.href='<{$template_edit_url}>';
		}


		//监听播放音乐
		var myAudio = document.getElementById('preMiuscAudio');
		var miuscIcon = $('#preMiusc_bgm').find('span:nth-child(2)');
		document.addEventListener('DOMContentLoaded', function () {
			function audioAutoPlay() {
				var audio = document.getElementById('preMiuscAudio');
					audio.play();
				document.addEventListener("WeixinJSBridgeReady", function () {
					audio.play();
				}, false);
			}
			audioAutoPlay();
		});
		function playPause(){
				if(myAudio.paused){
					myAudio.play();
					miuscIcon.css('-webkit-animation','play_sate 4s infinite');
				}else{
					myAudio.pause();
					miuscIcon.css('-webkit-animation','');
				}
		}


		


		//初始化弹框
		layui.use('layer', function() { //独立版的layer无需执行这一句
			var $ = layui.jquery,
				layer = layui.layer; //独立版的layer无需执行这一句
		});


		//保存弹框的函数
		function saveDialog() {
			var title = '<{$user_template_title}>' || '寒假报名';
			var miaoshu = '<{$user_template_digest}>' || '小蜜蜂琴行祝大家寒假快乐';
			var img_input = '<{$template_image}>';
			var tamp = "<form>";
			tplTitle = '<{$user_template_title}>' || '寒假报名';;
			tplDigest = '<{$user_template_digest}>' || '小蜜蜂琴行祝大家寒假快乐';
			tamp += "<div class='fen_title fen_title1' style='border-bottom:1px soild #ccc'>";
			tamp += "<label>分享标题：</label><input type='text' id='fen_t'  placeholder='请输入标题' value='" + title + "' />";
			tamp += "</div>";
			tamp += "<div class='fen_title'>";
			tamp += "<div class='left_box' onclick='fen_img.click()' ><i>更换封面</i>";
			tamp += "<input type='file' accept='image/*' id='fen_img' onClick=\"clipPhoto('#fen_img','#imgload','120','120','-1')\" value='请点击上传图片' style='display:none;' />";
			tamp += "<img src='" + img_input + "' class='my_img' id='imgload'/>";
			tamp += "</div>";
			tamp += "<div class='fen_title2'><textarea name='message' maxlength='60'  id='fen_miaoshu'>" + miaoshu + "</textarea><p id='dia_pageNum'><span>1</span><span>/</span><span>60</span></p></div>";
			tamp += "</div>";
			tamp += "<div class='layer_btn'>";
			tamp += "<a id='shareSave'>保存</a>";
			tamp += "</div>";
			tamp += "<div class='tishi'>这是分享后朋友们看见的标题、摘要和封面，请记得修改哦!</div>";
			tamp += "</form>";
			layer.open({
				skin:'winning-class',
				title: false,
				content: tamp,
				btn: false,
				success: function(layero) {
					$('' + layero.selector + '').find("div").css({ 'overflow': 'inherit' });
					$('.layui-layer-shade').css('opacity', '0.7');
					//textare的原本长度
					$('#dia_pageNum').find('span:nth-child(1)').html(miaoshu.length);
					//给分享图片赋予默认值
					shareBgi = '<{$template_image}>';
				}
			});

			$('#fen_t').change(function() {
				tplTitle = $(this).val()
			});

			$('#fen_miaoshu').change(function() {
				tplDigest = $(this).val()
			});

			$('#fen_miaoshu').bind('input propertychange', function() {
				$('#dia_pageNum').find('span:nth-child(1)').html($(this).val().length);
			});

			
			//点击分享保存
			$('.layer_btn').click(function() {

				if($('#fen_t').val() == "" || $('#fen_miaoshu') == "") {
					alert("请填写分享标题或内容~");
					return false;
				} else {

					//获取从编辑页面数据
					textJson = <{$user_template_json}>;

					//保存文字
					$.ajax({
						type: "post",
						url: "http://<{$sys_domain}>/modules/wap_user_tpl_edit/post.php?class=update",
						dataType: "json",
						data: {
							json: JSON.stringify(textJson),
							id: '<{$user_template_id}>',
							userid: '<{$template_user_id}>',
							tpl_project_name: '元旦节3',
							tpl_amount: 0,
							tplid: '<{$template_id}>',
							tpl_people: 10000,
							tpl_title: tplTitle,
							tpl_digest: tplDigest,
							tpl_img: tal_shareBgi[0],
							tpl_amount: ""
						},
						success: function(data) {
							debugger;
							//如果等于‘0’就是新增的，跳转页面时加上返回的uniqid
							if(data.status = true && '<{$user_template_id}>' == 0) {
								location.href = '<{$user_template_url}>' + data.data.uniqid;
							} else if(data.status = true){
								location.href = '<{$user_template_url}>';
							}else{
								alert(data.data.msg);
							}

						}
					});

				}

		});

	}



	//自定义图片（裁剪）函数
	//file_id上传图片的（input）id，view_id:截图完成显示的id(img);
	//view_width,view_height:截取区域宽高，imgIndex:图片的下标
	function clipPhoto(file_id,view_id,view_width,view_height,imgIndex){
		var v_id;
		//等于-1就是分享图片
		if(imgIndex != -1){
			v_id = '#'+$(view_id)[0].id;
			$(view_id).next().click();
		}else{
			v_id = view_id;
		}
		$("#clipArea").photoClip({
			width: view_width,
			height: view_height,
			file: file_id,
			view: v_id,//传进来的$(this),所以要拿id
			ok: "#clipBtn", //确定裁剪的按钮
			loadStart: function () {
				//开始加载回调函数，this指向 fileReader 对象
				$(".caiBox").show();
			},
			loadComplete: function () {
				//加载完成的回调函数。this指向图片对象
			},
			clipFinish: function (dataURL) {
				//裁剪完成的回调函数。this指向图片对象
				$(v_id).attr('src', dataURL);
				if(imgIndex != '-1'){
					//给自定义图片数组赋值（不包含分享图片）
					imgArr[imgIndex] = dataURL;
				}else{
					tal_shareBgi.push(dataURL);
				}
				//隐藏截图页面
				$(".caiBox").hide();
				//放大缩小后从新渲染截图背景
				render(dataURL);
				//清空上一张图片的缓存
				$(".photo-clip-mask").remove();
				$(".photo-clip-view").remove();
			}
		});
	};
	//关闭裁剪函数
	function Close(){
		$('.caiBox').hide();
	} 
	// 渲染 Image 缩放尺寸  
	function render(src){  
		 var MAX_HEIGHT = 256;  //Image 缩放尺寸 
		// 创建一个 Image 对象  
		var image = new Image();  
		
		// 绑定 load 事件处理器，加载完成后执行  
		image.onload = function(){  
			// 获取 canvas DOM 对象  
			var canvas = document.getElementById("myCanvas"); 
			// 如果高度超标  
			if(image.height > MAX_HEIGHT) {  
				// 宽度等比例缩放 *=  
				image.width *= MAX_HEIGHT / image.height;  
				image.height = MAX_HEIGHT;  
			}  
			// 获取 canvas的 2d 环境对象,  
			// 可以理解Context是管理员，canvas是房子  
			var ctx = canvas.getContext("2d");  
			// canvas清屏  
			ctx.clearRect(0, 0, canvas.width, canvas.height); 
			canvas.width = image.width;        // 重置canvas宽高  
			canvas.height = image.height;  
			// 将图像绘制到canvas上  
			/*ctx.drawImage(image, 0, 0, image.width, image.height); */ 
			// !!! 注意，image 没有加入到 dom之中  
			
		 var dataurl = canvas.toDataURL("image/jpeg");  
		 var imagedata =  encodeURIComponent(dataurl); 
		};  
		// 设置src属性，浏览器会自动加载。  
		// 记住必须先绑定render()事件，才能设置src属性，否则会出同步问题。  
		image.src = src;	
	};




	//举报选项的渲染
	layui.use(['form', 'layedit', 'laydate'], function(){
	  var form = layui.form
	  ,layer = layui.layer
	  ,layedit = layui.layedit
	  ,laydate = layui.laydate;
	  form.render();
	  $(".layui-anim.layui-icon").click(function(){
			$(".layui-textarea").css("display","none");
			$(".div5 .layui-unselect i").click(function(){
				$(".layui-textarea").css("display","block")
			});
		});
	});
	
	//点击举报
	function jubaoShow(){
		$(".jubao").show();
		$(".hide_all").show();
		//监听举报选中
	};
	//关闭举报
	function close_jibao(){
		$(".jubao").fadeOut(500);
		$(".hide_all").fadeOut(1000);
	};

	//点击举报提交
	function check(form) {
		var value = $(".layui-form-radioed").children("span").text();
		var type;
		$("input[name=reason]").each(function(){
			if($(this).next("div").hasClass("layui-form-radioed")){type = $(this).val();};
		});
		if($(".layui-unselect").hasClass("layui-form-radioed")){
			if($(".reason5").next("div").hasClass("layui-form-radioed")){value = $(".layui-textarea").val();};
			$.ajax({
						type: "post",
						dataType: "json",
						url: "http://<{$sys_domain}>/modules/wap_tpl_list/complain.php",
						data:{
							id:'<{$user_template_id}>',
							reason:value,
							type:type,
							
						},
						success: function (e) {
							if(e.status == true){
								layer.msg('举报成功', {time: 3000, icon:6});
								$(".jubao").fadeOut(1000);
								$(".hide_all").fadeOut(3000);
							}
							else{layer.msg('您已经举报过了，请不要重新举报哦~', {time: 3000, icon:7});$(".jubao").fadeOut(1000);$(".hide_all").fadeOut(3000);}
						},
						error:function(e){
							
						},
					});
			return false;
		}
		else{layer.msg('请选择举报内容', {time: 3000, icon:7});$(".jubao").hide();setTimeout(function(){$(".jubao").show()},3000);return false;}
		return false;
	};
	//举报里的点击函数
	function other(){
		$(".layui-textarea").css("display","block");
	};
	function other1(){
		$(".layui-textarea").css("display","none");;
	};

	</script>
	<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
	<script>
		document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
			if(sessionStorage.getItem('a') == 1) {
				// 通过下面这个API隐藏右上角按钮
				WeixinJSBridge.call('hideOptionMenu');
			} else {
				WeixinJSBridge.call('showOptionMenu');
			}
		});
		wx.config({
			appId: '<{$wxjs_appId}>',
			timestamp: <{$wxjs_timestamp}>,
			nonceStr: '<{$wxjs_nonceStr}>',
			signature: '<{$wxjs_signature}>',
			jsApiList: [
				'onMenuShareTimeline',
				'onMenuShareAppMessage',
				'onMenuShareQQ',
				'onMenuShareWeibo'
			]
		});
		wx.ready(function () {
		  var share_url=window.location.href;
		  var share_imgUrl='<{$template_image}>'; 
		  var t1 = '<{$user_template_title}>';
		  var t2 ='<{$user_template_digest}>';
		  var shareData = {
			title: t1,
			desc: t2,
			link: share_url,
			'imgUrl': share_imgUrl,
			success:function(){
				$.ajax({
					type: "post",
					url: "http://<{$sys_domain}>/modules/wap_user_tpl_info/post.php?class=share&timestamp=<{$wxjs_timestamp}>&p_id=<{$user_template_id}>",
					dataType: "text",
					success: function(data) {
					
					}
				});
			}
		  };
		  wx.onMenuShareAppMessage(shareData);
		  wx.onMenuShareTimeline(shareData);
		  wx.onMenuShareQQ(shareData);
		  wx.onMenuShareWeibo(shareData);
		});
		wx.error(function (res) {
		  /*alert(res.errMsg);*/
		  //alert('<{$wxjs_appId}>'+'+'+'<{$wxjs_timestamp}>'+'+'+'<{$wxjs_nonceStr}>'+'+'+'<{$wxjs_signature}>')
		});
	</script>


</html>