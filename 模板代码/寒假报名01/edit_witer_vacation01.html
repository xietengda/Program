<!DOCTYPE html>
<html>

	<head>
		<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0" />
		<meta charset="UTF-8">
		<title>寒假招生</title>
		<link rel="stylesheet" href="http://qhb.lelego.net.cn/upload/tpl_file/public/module_swiper.min.css" />
		<link rel="stylesheet" href="http://qhb.lelego.net.cn/plugins/layui/css/layui.css">
		<link rel="stylesheet" href="http://qhb.lelego.net.cn/upload/tpl_file/public/mobiscroll.custom-2.5.2.min.css">
		<link rel="stylesheet" href="<{$template_path}>/winter_vacation01.css" />
		<style>
			body {
				background-color: #EDEDED;
			}
			
			#father {
				width: 80%;
				height: 80%;
				margin: 0 auto;
				padding-top: 10%;
			}
			
			#pageDiv {
				margin: 0 auto;
				width: 80%;
				margin-top: 0.2rem;
			}
			/*虚线*/
			
			.editBorder {
				border: 1px dashed black;
			}
			
			.swi3_cont_img_layer {
				display: inline-block;
				width: 1.7rem;
				height: 1.8rem;
				border-radius: 0.1rem;
				background-color: black;
				opacity: 0.3;
				position: absolute;
				z-index: 3;
				margin-top: -1%;
			}
			
			
			.swi1_edit_title{
				margin-top: 1.5rem !important
			}
			
			#date_input_1{
		        width: 18%;
			    height: 5%;
			    border: 1px solid red;
			    position: absolute;
			    margin-top: -10%;
			    margin-left: -9%;
			    opacity: 0;
			}
			#date_input_2{
			    position: absolute;
			    width: 18%;
			    height: 5%;
			    border: 1px solid red;
			    margin-top: -10%;
			    margin-left: 15%;
			    opacity: 0;
			}
			.gallery_edit_top_img{
				width: 1.8rem !important;
				height: 1.8rem !important;
			}
			.swi4_edit_cont_1>div span:nth-child(1){
				font-size: 0.32rem !important;
			}
			
			.swi4_close_span{
			    position: absolute;
			    width: 7%;
			    right: 1rem;
			}
			.swi4_addBox{
				border: 1px solid #3b6e40;
			    width: 100%;
			    margin: 0 auto;
			    text-align: center;
			    height: 0.6rem;
			}
			.swi4_addBox img{
				width: 10%;
				margin: 0 auto;
			}
			.swi4_cont_close{
				position: absolute;
			    width: 8% !important;
			    margin-top: -20%;
			    margin-left: 95%;

			}
			.swi4_two_addBox{
				width: 100%;
				height: 1.06rem !important;
				border: 1px solid #3b6e40;
				text-align: center;
			}
			.swi4_two_addBox img{
				width: 18%;
				margin: 0 auto;
			}
		</style>
	</head>

	<body>

		<!--编辑弹框和遮层-->
		<div id="edit_dialog" class="divHide">
			<textarea></textarea>
			<input id="edit_number_input" type="number" class="divHide" />
			<div id="edit_input_layer" class="divHide"></div>
			<ul>
				<li id="edit_qx" onclick="edit_qxFun()">取消</li>
				<li id="edit_length"><span>12</span>/<span>20</span></li>
				<li id="edit_qd" onclick="edit_qdFun()">确定</li>
			</ul>
		</div>
		<div id="edit_layer" class="divHide"></div>
		<!--编辑弹框和遮层-->

		<div id="father">
			<div class="swiper-container text_swiper">
				<div class="swiper-wrapper">
					<div class="swiper-slide" id="swi1">
						<div id="swi1_title" class="swi1_edit_title">
							<img src="<{$template_path}>/home_title@2x.png" />
						</div>
						<div id="swi1_cont_1">
							<span id="ed1" class="editBorder" onclick="edit_onFuntion($(this),6)">寒期优惠招生</span><span>|</span><span id="ed2" class="editBorder" onclick="edit_onFuntion($(this),6)">课程免费赠送</span>
						</div>
						<div id="swi1_cont_2">
							<p>活动时间：<span class="editBorder"><span id="ed3">1</span>月<span id="ed4">15</span>日</span>至<span class="editBorder"><span id="ed5">2</span>月<span id="ed6">30</span>日</span></p>
							<input id="date_input_1" readonly="readonly" onfocus="this.blur()" />
							<input id="date_input_2" readonly="readonly" onfocus="this.blur()" />
						</div>
						<div id="swi1_cont_3">
							<p id="ed7" onclick="edit_onFuntion($(this),15)" class="editBorder">新老学员凡关注小蜜蜂琴行公众号</p>
						</div>
						<div id="swi1_cont_4">
							<p id="ed8" onclick="edit_onFuntion($(this),20)" class="editBorder">转发本链接到朋友圈即可享受以下优惠大礼包</p>
						</div>
					</div>
					<div class="swiper-slide swi_bgi" id="swi2">
						<div class="swi_title">
							<p id="ed9" onclick="edit_onFuntion($(this),5)" class="editBorder">小蜜蜂琴行</p>
						</div>
						<div id="swi2_cont_img" class="swi2_edit_cont_img">
							<img id="edimg1" onClick="clipPhoto('#edimg1_img',$(this),'540','300','0')" class="editBorder" src="<{$template_path}>/pic_mechanism@2x.png" />
							<input id="edimg1_img" type="file" accept="image/*" style="display: none;" />
						</div>
						<div id="swi2_cont_cont" class="swi2_edit_cont_cont">
							<p id="ed10" onclick="edit_onFuntion($(this),100)" class="editBorder">小蜜蜂琴行成立于2015年，是子昊专业钢琴音乐教育旗下直营琴行，拥有15年行业经验。同时也是高明首家引进智能钢琴集体课的琴行，行内设备先进，师资雄厚。小蜜蜂琴行自成立以来，广受家长和学生好评。</p>
						</div>

					</div>
					<div class="swiper-slide swi_bgi" id="swi3">
						<div class="swi_title">
							<p id="ed11" onclick="edit_onFuntion($(this),6)" class="editBorder">精品课程介绍</p>
						</div>



						<!-- <div id="swi3_cont_img" class="swi3_edit_cont_img">
							<div id="swi3_cont_img_1"  value='1'>
								<img id="edimg2" onClick="clipPhoto('#edimg2_img',$(this),'160','160','1')" class="editBorder" src="<{$template_path}>/pic_seleted@2x.png" />
								<input id="edimg2_img" type="file" accept="image/*" style="display: none;" />
								<span class="close_span" onclick="closeFun('#swi3_cont_img_1','#addBox1','#swi3_cont_cont_1')">
									<img src="http://qhb.lelego.net.cn/upload/tpl_file/public/module_close.png"/>
								</span>
							</div>
							
							<div id="addBox1" class="addBox divHide" value='1'>
								<img onclick="addFun('#swi3_cont_img_1','#addBox1','#swi3_cont_cont_1')" src='http://qhb.lelego.net.cn/upload/tpl_file/public/module_add.png' />
							</div>
							<div id="swi3_cont_img_2" value='2'>
								<i class="swi3_cont_img_layer" onclick="changeClassFun($(this))"></i>
								<img id="edimg3" onClick="clipPhoto('#edimg3_img',$(this),'160','160','2')" class="editBorder" src="<{$template_path}>/pic_seleted@2x.png" />
								<input id="edimg3_img" type="file" accept="image/*" style="display: none;" />
								<span class="close_span" onclick="closeFun('#swi3_cont_img_2','#addBox2','#swi3_cont_cont_2')">
									<img src="http://qhb.lelego.net.cn/upload/tpl_file/public/module_close.png"/>
								</span>
							</div>
							
							<div id="addBox2" class="addBox divHide" value='2'>
								<img onclick="addFun('#swi3_cont_img_2','#addBox2','#swi3_cont_cont_2')" src='http://qhb.lelego.net.cn/upload/tpl_file/public/module_add.png' />
							</div>
							<div id="swi3_cont_img_3" value='3'>
								<i class="swi3_cont_img_layer" onclick="changeClassFun($(this))"></i>
								<img id="edimg4" onClick="clipPhoto('#edimg4_img',$(this),'160','160','3')" class="editBorder" src="<{$template_path}>/pic_seleted@2x.png" />
								<input id="edimg4_img" type="file" accept="image/*" style="display: none;" />
								<span class="close_span" onclick="closeFun('#swi3_cont_img_3','#addBox3','#swi3_cont_cont_3')">
									<img src="http://qhb.lelego.net.cn/upload/tpl_file/public/module_close.png"/>
								</span>
							</div>
							
							<div id="addBox3" class="addBox divHide" value='3'>
								<img onclick="addFun('#swi3_cont_img_3','#addBox3','#swi3_cont_cont_3')" src='http://qhb.lelego.net.cn/upload/tpl_file/public/module_add.png' />
							</div>
						</div>
						<div id="swi3_cont_cont">
							<div id="swi3_cont_cont_1">
								<p id="ed12" onclick="edit_onFuntion($(this),10)" class="editBorder">《钢琴启蒙班》</p>
								<p>— — — — — — — — — — — — — — — — —</p>
								<p id="ed13" onclick="edit_onFuntion($(this),40)" class="editBorder">启蒙班集体课，适合4-7岁的孩子，通过动画故事进行知识讲解通俗易懂，引人入胜。</p>
							</div>
							<div id="swi3_cont_cont_2" class="divHide">
								<p id="ed14" onclick="edit_onFuntion($(this),10)" class="editBorder">《一对一钢琴班》</p>
								<p>— — — — — — — — — — — — — — — — —</p>
								<p id="ed15" onclick="edit_onFuntion($(this),40)" class="editBorder">目前最高效的钢琴授课方式，老师根据学生的情况制定教学方案，让您的孩子进步神速。</p>
							</div>
							<div id="swi3_cont_cont_3" class="divHide">
								<p id="ed16" onclick="edit_onFuntion($(this),10)" class="editBorder">《音基集体课》</p>
								<p>— — — — — — — — — — — — — — — — —</p>
								<p id="ed17" onclick="edit_onFuntion($(this),40)" class="editBorder">特色课程，音乐基础是学音乐必修的知识，就像学英语一样，音标学好了，英语才会学得好。</p>
							</div>
						</div> -->

						<div id="swi3_cont_swiper">
							<div class="swiper-container gallery-thumbs" style="height: 35%">
						        <div class="swiper-wrapper">
						            <div class="swiper-slide gallery_top_img gallery_edit_top_img"  id="gallery_top_img_1">
						            	<div id="swi3_cont_img_1"  value='1'>
											<img id="edimg2" onClick="clipPhoto('#edimg2_img',$(this),'160','160','1')" class="editBorder" src="<{$template_path}>/pic_seleted@2x.png" />
											<input id="edimg2_img" disabled="disabled" type="file" accept="image/*" style="display: none;" />
											<span class="close_span" onclick="closeFun('#swi3_cont_img_1','#addBox1','#swi3_cont_cont_1')">
												<img src="http://qhb.lelego.net.cn/upload/tpl_file/public/module_close.png"/>
											</span>
										</div>
										<!--添加框-->
										<div id="addBox1" class="addBox divHide" value='1'>
											<img onclick="addFun('#swi3_cont_img_1','#addBox1','#swi3_cont_cont_1')" src='http://qhb.lelego.net.cn/upload/tpl_file/public/module_add.png' />
										</div>
						            </div>
						            <div class="swiper-slide gallery_top_img gallery_edit_top_img"  id="gallery_top_img_2">
						            	<div id="swi3_cont_img_2" value='2'>
											<img id="edimg3" onClick="clipPhoto('#edimg3_img',$(this),'160','160','2')" class="editBorder" src="<{$template_path}>/pic_seleted@2x.png" />
											<input id="edimg3_img" disabled="disabled" type="file" accept="image/*" style="display: none;" />
											<span class="close_span" onclick="closeFun('#swi3_cont_img_2','#addBox2','#swi3_cont_cont_2')">
												<img src="http://qhb.lelego.net.cn/upload/tpl_file/public/module_close.png"/>
											</span>
										</div>
										<!--添加框-->
										<div id="addBox2" class="addBox divHide" value='2'>
											<img onclick="addFun('#swi3_cont_img_2','#addBox2','#swi3_cont_cont_2')" src='http://qhb.lelego.net.cn/upload/tpl_file/public/module_add.png' />
										</div>
						            </div>
						            <div class="swiper-slide gallery_top_img gallery_edit_top_img"  id="gallery_top_img_3">
						            	<div id="swi3_cont_img_3" value='3'>
											<img id="edimg4" onClick="clipPhoto('#edimg4_img',$(this),'160','160','3')" class="editBorder" src="<{$template_path}>/pic_seleted@2x.png" />
											<input id="edimg4_img" disabled="disabled" type="file" accept="image/*" style="display: none;" />
											<span class="close_span" onclick="closeFun('#swi3_cont_img_3','#addBox3','#swi3_cont_cont_3')">
												<img src="http://qhb.lelego.net.cn/upload/tpl_file/public/module_close.png"/>
											</span>
										</div>
										<!--添加框-->
										<div id="addBox3" class="addBox divHide" value='3'>
											<img onclick="addFun('#swi3_cont_img_3','#addBox3','#swi3_cont_cont_3')" src='http://qhb.lelego.net.cn/upload/tpl_file/public/module_add.png' />
										</div>
						            </div>
						        </div>
						    </div>
						    <div class="swiper-container gallery-top">
						        <div class="swiper-wrapper">
						            <div class="swiper-slide gallery_thumbs_cont" id="gallery_thumbs_cont_1">
						            	<div id="swi3_cont_cont_1">
											<p id="ed12" onclick="edit_onFuntion($(this),10)" class="editBorder">《钢琴启蒙班》</p>
											<p>— — — — — — — — — — — — — — — — —</p>
											<p id="ed13" onclick="edit_onFuntion($(this),40)" class="editBorder">启蒙班集体课，适合4-7岁的孩子，通过动画故事进行知识讲解通俗易懂，引人入胜。</p>
										</div>
						            </div>
						            <div class="swiper-slide gallery_thumbs_cont"  id="gallery_thumbs_cont_2">
						            	<div id="swi3_cont_cont_2">
											<p id="ed14" onclick="edit_onFuntion($(this),10)" class="editBorder">《一对一钢琴班》</p>
											<p>— — — — — — — — — — — — — — — — —</p>
											<p id="ed15" onclick="edit_onFuntion($(this),40)" class="editBorder">目前最高效的钢琴授课方式，老师根据学生的情况制定教学方案，让您的孩子进步神速。</p>
										</div>
						            </div>
						            <div class="swiper-slide gallery_thumbs_cont"  id="gallery_thumbs_cont_3">
						            	<div id="swi3_cont_cont_3">
										<p id="ed16" onclick="edit_onFuntion($(this),10)" class="editBorder">《音基集体课》</p>
										<p>— — — — — — — — — — — — — — — — —</p>
										<p id="ed17" onclick="edit_onFuntion($(this),40)" class="editBorder">特色课程，音乐基础是学音乐必修的知识，就像学英语一样，音标学好了，英语才会学得好。</p>
									</div>
						            </div>
						        </div>
						    </div>
						</div>


					</div>








					<div class="swiper-slide swi_bgi" id="swi4">
						<div class="swi_title">
							<p id="ed18" onclick="edit_onFuntion($(this),6)" class="editBorder">现报名超划算</p>
						</div>
						<div id="swi4_cont_1" class="swi4_edit_cont_1">
							<div class="editBorder" id="swi4_cont_one_1">
								<img  id="zeng" src="<{$template_path}>/icon_list_gift@2x.png">
								<span id="ed19" onclick="edit_onFuntion($(this),15)" class="editBorder">报名即赠送540元课程</span>
								<span class="swi4_close_span" onclick="closeFun('#swi4_cont_one_1','#addBox4')">
									<img src="http://qhb.lelego.net.cn/upload/tpl_file/public/module_close.png"/>
								</span>
							</div>
							<!--添加框-->
							<div id="addBox4" class="swi4_addBox divHide">
								<img onclick="addFun('#swi4_cont_one_1','#addBox4')" src='http://qhb.lelego.net.cn/upload/tpl_file/public/module_add.png' />
							</div>

							<div  class="editBorder"  id="swi4_cont_one_2">
								<img id="zhe" src="<{$template_path}>/icon_list_discount@2x.png">
								<span id="ed20" onclick="edit_onFuntion($(this),15)" class="editBorder">学期、学年报班享折上折</span>
								<span class="swi4_close_span" onclick="closeFun('#swi4_cont_one_2','#addBox5')">
									<img src="http://qhb.lelego.net.cn/upload/tpl_file/public/module_close.png"/>
								</span>
							</div>
							<!--添加框-->
							<div id="addBox5" class="swi4_addBox divHide">
								<img onclick="addFun('#swi4_cont_one_2','#addBox5')"  src='http://qhb.lelego.net.cn/upload/tpl_file/public/module_add.png' />
							</div>


							<div  class="editBorder"  id="swi4_cont_one_3">
								<img  id="shou" src="<{$template_path}>/icon_list_first@2x.png">
								<span id="ed21" onclick="edit_onFuntion($(this),15)" class="editBorder">首次报名即送开学大礼包</span>
								<span class="swi4_close_span" onclick="closeFun('#swi4_cont_one_3','#addBox6')">
									<img src="http://qhb.lelego.net.cn/upload/tpl_file/public/module_close.png"/>
								</span>
							</div>
							<!--添加框-->
							<div id="addBox6" class="swi4_addBox divHide">
								<img onclick="addFun('#swi4_cont_one_3','#addBox6')"  src='http://qhb.lelego.net.cn/upload/tpl_file/public/module_add.png' />
							</div>
						</div>
						<div id="swi4_cont_hr" class="swi4_edit_cont_hr">
							<p>— — — — — — — — — — — — — — — — — —</p>
						</div>
						<div id="swi4_cont_2" class="swi4_edit_cont_2">
							<div id="swi4_cont_two_1" class="editBorder">
								<span><img src="<{$template_path}>/icon_gift@2x.png" /> </span>
								<span id="ed22" onclick="edit_onFuntion($(this),26)" class="editBorder">转发此链接到朋友圈，报满一期20节，即送2节课程！</span>
								<span class="swi4_cont_close" onclick="closeFun('#swi4_cont_two_1','#addBox7')">
									<img src="http://qhb.lelego.net.cn/upload/tpl_file/public/module_close.png"/>
								</span>
							</div>
							<!--添加框-->
							<div id="addBox7" class="swi4_two_addBox divHide">
								<img onclick="addFun('#swi4_cont_two_1','#addBox7')"  src='http://qhb.lelego.net.cn/upload/tpl_file/public/module_add.png' />
							</div>
							<div id="swi4_cont_two_2" class="editBorder">
								<span><img src="<{$template_path}>/icon_gift@2x.png" /> </span>
								<span id="ed23" onclick="edit_onFuntion($(this),26)" class="editBorder">老学员介绍新学员报名成功双方即可免费获得2节课程！</span>
								<span class="swi4_cont_close" onclick="closeFun('#swi4_cont_two_2','#addBox8')">
									<img src="http://qhb.lelego.net.cn/upload/tpl_file/public/module_close.png"/>
								</span>
							</div>
							<!--添加框-->
							<div id="addBox8" class="swi4_two_addBox divHide">
								<img onclick="addFun('#swi4_cont_two_2','#addBox8')"  src='http://qhb.lelego.net.cn/upload/tpl_file/public/module_add.png' />
							</div>
							<div id="swi4_cont_two_3" class="editBorder">
								<span><img src="<{$template_path}>/icon_gift@2x.png" /> </span>
								<span id="ed24" onclick="edit_onFuntion($(this),26)" class="editBorder">新学员报满一期20节，即可获得子昊专业教材一份。</span>
								<span class="swi4_cont_close" onclick="closeFun('#swi4_cont_two_3','#addBox9')">
									<img src="http://qhb.lelego.net.cn/upload/tpl_file/public/module_close.png"/>
								</span>
							</div>
							<!--添加框-->
							<div id="addBox9" class="swi4_two_addBox divHide">
								<img onclick="addFun('#swi4_cont_two_3','#addBox9')"  src='http://qhb.lelego.net.cn/upload/tpl_file/public/module_add.png' />
							</div>
						</div>
						<div id="swi4_footer" class="swi4_edit_footer">
							<p id="ed25" onclick="edit_onFuntion($(this),34)" class="editBorder">注：以上礼包可同时领取，钢琴班报读一期20节课即可参加此次活动~</p>
						</div>
					</div>
					<div class="swiper-slide swi_bgi" id="swi5">
						<div class="swi_title">
							<p id="ed26" onclick="edit_onFuntion($(this),6)" class="editBorder">联系方式</p>
						</div>
						<div id="swi5_cont_1">
							<p>联系电话：<span id="ed27" onclick="edit_onFuntion($(this),15)" class="editBorder">075788889031</span></p>
							<p>联系地址：<span id="ed28" class="editBorder" onclick="new_map()">佛山市高明区跃华路小蜜蜂琴行（永安花园对面）</span></p>
						</div>
						<div id="swi5_map" class="swi5_edit_map" onclick="new_map()">
							<div class=" Frame_wap_user_organization_edit" id="Frame61">
								<form action="" method="post" id="Frame60_form_1">
									<input name="id" type="hidden" value="60" />
									<input name="oid" type="hidden" value="1" />
									<div class="main pt10">
										<input type="hidden" name="lat" /> <input type="hidden" name="lng" />
										<div id="container_61" class="map" style="height:3rem !important; z-index:99"></div>
										<div class="dno" id="Address_list"></div>
									</div>
								</form>
							</div>
						</div>
						<div id="swi5_footer" class="swi5_edit_footer">
							<ul>
								<li>
									<a href="javascript:void(0)">我要咨询</a>
								</li>
								<li>我要报名</li>
							</ul>
						</div>
					</div>
					<!-- Add Pagination -->
					<div class="swiper-pagination"></div>
				</div>
				
				<!--底部光标-->
				<div id="pageDiv">
					<!--页数-->
					<div id="pageNum"><span>1</span>/5</div>
				</div>
			</div>
			
			<!--编辑地图-->
			<div class="text_input map_new">
				<div class=" Frame_wap_user_organization_edit" id="Frame60">
					<form action="" method="post" id="Frame60_form_1">
						<input name="id" type="hidden" value="60" />
						<input name="oid" type="hidden" value="1" />
						<div class="main pt10">
	
							<input type="hidden" name="lat" /> <input type="hidden" name="lng" />
							<div id="container_60" class="map" style="height:7rem; z-index:99"></div>
							<div class="dno" id="Address_list"></div>
						</div>
					</form>
				</div>
				<div class="newmap" id="address"></div>
				<div class="q_map">
					<a onClick="que()">确定</a>
				</div>
			</div>
				

			<!--底部四个按钮-->
			<div class="footer">
				<a id="change_music" onclick='changeMiuscFun()'><i><img src="http://qhb.lelego.net.cn/upload/tpl_file/public/module_edit-page_icon_edit@2x.png"/></i>音乐</a>
				<!--<a id="change_bg"><i><img src="edit-page_icon_bg@2x.png"/></i>背景</a>-->
				<a id="save" onClick="saveDialog()"><i><img src="http://qhb.lelego.net.cn/upload/tpl_file/public/module_edit-page_icon_save@2x.png"/></i>保存</a>
				<a id="preview" onclick="previewFun()"><i><img src="http://qhb.lelego.net.cn/upload/tpl_file/public/module_edit-page_icon_preview@2x.png"/></i>预览</a>
			</div>

			<!--图片裁剪框-->
			<div class="caiBox">
				<h2 style="width:100%; text-align:center; position:fixed; top:0; left:0; line-height:0.6rem; font-size:0.4rem;color:#4eaf7a; z-index:999999999">双指旋转和双指缩放</h2>
				<button id="clipBtn">确定裁剪</button>
				<button id="clipBtn1" onClick="Close()">取消</button>
				<div id="clipArea"></div>
				<canvas id="myCanvas" style=" display:none"></canvas>
			</div>
			<!--图片裁剪框-->

	</body>
	<script type="text/javascript" src="https://cdn.bootcss.com/jquery/2.2.0/jquery.min.js"></script>
	<script type="text/javascript" src="http://qhb.lelego.net.cn/upload/tpl_file/public/adaptive.js"></script>
	<script type="text/javascript" src="http://qhb.lelego.net.cn/upload/tpl_file/public/module_swiper.js"></script>
	<!--地图-->
	<script charset="utf-8" src="http://map.qq.com/api/js?v=2.exp&libraries=convertor"></script>
	<script type="text/javascript" src="https://3gimg.qq.com/lightmap/components/geolocation/geolocation.min.js"></script>
	<script type="text/javascript" src="http://qhb.lelego.net.cn/upload/tpl_file/public/module_wap_qq_map.js"></script>
	<script src="http://qhb.lelego.net.cn/plugins/layui/layui.js"></script>
	<!--图片插件-->
	<script src="http://qhb.lelego.net.cn/js/LocalResizeIMG/patch/mobileBUGFix.mini.js"></script>
	<script type="text/javascript" src="http://qhb.lelego.net.cn/upload/tpl_file/public/module_LocalResizeIMG.js"></script>
	<!--图片裁剪-->
	<script type="text/javascript" src="http://qhb.lelego.net.cn/upload/tpl_file/public/jquery.photoClip.js"></script>
	<script type="text/javascript" src="http://qhb.lelego.net.cn/upload/tpl_file/public/hammer.js"></script>
	<script type="text/javascript" src="http://qhb.lelego.net.cn/upload/tpl_file/public/iscroll-zoom.js"></script>
	<script type="text/javascript" src="http://qhb.lelego.net.cn/upload/tpl_file/public/sonic.js"></script>
	<!--日期插件-->
	<script type="text/javascript" src="http://qhb.lelego.net.cn/upload/tpl_file/public/mobiscroll.core-2.5.2.js"></script>
	<script type="text/javascript" src="http://qhb.lelego.net.cn/upload/tpl_file/public/mobiscroll.datetime-2.5.1.js"></script>
	<script>
		//文字图片保存Json
		var textJson = {};
		//位置坐标x
		var positionX = 22.896310;
		//位置坐标Y
		var positionY = 112.867850;
		//自定义图片
		var imgArr = new Array();
		//背景音乐(默认)
		var bgdMusic;
		//分享封面图片
		var tal_shareBgi = new Array();
		//编辑页面显示的地图
		var map61 = new wap_qq_map('container_61');

		//活动开始时间
		var timestampStart = 0;
		//活动结束时间
		var timestampStop = 0;

		

		




		$(document).ready(function() {
			//判断previewJson是否为空(如果不为空在判断是否是新增，如果为空则渲染templateJson数据)
			if('<{$user_preview_json}>' == '{}') {
				//判断是否是新增（根据'<{$user_template_id}>'== 0判断）
				console.log(<{$user_template_id}>);
				if('<{$user_template_id}>' == '0'){

					//首次进入，定位到默认位置
					map61.init(positionX,positionY);

					//新增就音乐一个默认值
					bgdMusic = 'http://qhb.lelego.net.cn/upload/ed-pic/5896a94e24168/5a0fd62ac33f2/5a0fd65bb1702.mp3';
					return bgdMusic;
				}else{
					//从列表的编辑进入页面
					var textJson_tem  = <{$user_template_json}>;
					console.log("列表编辑=$user_template_json==="+JSON.stringify(textJson_tem));

					
					//渲染文字
					for(var key in textJson_tem){
						if(key =='ed12' || key =='ed13'){
							if(textJson_tem[key] == 'hide'){
								$('#swi3_cont_cont_1').addClass('divHide');
								$('#swi3_cont_img_1').addClass('divHide');
								$('#addBox1').removeClass('divHide');
							}else{
								$($('#'+key+'').selector).html(textJson_tem[key]);
							}
						}else if(key =='ed14' || key =='ed15'){
							if(textJson_tem[key] == 'hide'){
								$('#swi3_cont_cont_2').addClass('divHide');
								$('#swi3_cont_img_2').addClass('divHide');
								$('#addBox2').removeClass('divHide');
							}else{
								$($('#'+key+'').selector).html(textJson_tem[key]);
							}
						}else if(key =='ed16' || key =='ed17'){
							if(textJson_tem[key] == 'hide'){
								$('#swi3_cont_cont_3').addClass('divHide');
								$('#swi3_cont_img_3').addClass('divHide');
								$('#addBox3').removeClass('divHide');
							}else{
								$($('#'+key+'').selector).html(textJson_tem[key]);
							}
						}else if(key =='ed19'){
							if(textJson_tem[key] == 'hide'){
								$('#swi4_cont_one_1').addClass('divHide');
								$('#addBox4').removeClass('divHide');
							}else{
								$($('#'+key+'').selector).html(textJson_tem[key]);
							}
						}else if(key =='ed20'){
							if(textJson_tem[key] == 'hide'){
								$('#swi4_cont_one_2').addClass('divHide');
								$('#addBox5').removeClass('divHide');
							}else{
								$($('#'+key+'').selector).html(textJson_tem[key]);
							}
						}else if(key =='ed21'){
							if(textJson_tem[key] == 'hide'){
								$('#swi4_cont_one_3').addClass('divHide');
								$('#addBox6').removeClass('divHide');
							}else{
								$($('#'+key+'').selector).html(textJson_tem[key]);
							}
						}else if(key =='ed22'){
							if(textJson_tem[key] == 'hide'){
								$('#swi4_cont_two_1').addClass('divHide');
								$('#addBox7').removeClass('divHide');
							}else{
								$($('#'+key+'').selector).html(textJson_tem[key]);
							}
						}else if(key =='ed23'){
							if(textJson_tem[key] == 'hide'){
								$('#swi4_cont_two_2').addClass('divHide');
								$('#addBox8').removeClass('divHide');
							}else{
								$($('#'+key+'').selector).html(textJson_tem[key]);
							}
						}else if(key =='ed24'){
							if(textJson_tem[key] == 'hide'){
								$('#swi4_cont_two_3').addClass('divHide');
								$('#addBox9').removeClass('divHide');
							}else{
								$($('#'+key+'').selector).html(textJson_tem[key]);
							}
						}else{
							 $($('#'+key+'').selector).html(textJson_tem[key]);
						}
					}


					
					//渲染自定义图片
					//自定义图片的渲染
					$.each(textJson_tem['imgArr'],function(i){
						if( (i+1) == 2){
							if(textJson_tem['imgArr'][i] == 'hide'){
								$('#swi3_cont_img_1').addClass('divHide');
								$('#addBox1').removeClass('divHide');
							}else{
								$('#edimg'+(i+1)+'').attr('src',textJson_tem['imgArr'][i]);
							}
						}else if( (i+1) == 3){
							if(textJson_tem['imgArr'][i] == 'hide'){
								$('#swi3_cont_img_2').addClass('divHide');
								$('#addBox2').removeClass('divHide');
							}else{
								$('#edimg'+(i+1)+'').attr('src',textJson_tem['imgArr'][i]);
							}
						}else if( (i+1) == 4){
							if(textJson_tem['imgArr'][i] == 'hide'){ 
								$('#swi3_cont_img_3').addClass('divHide');
								$('#addBox3').removeClass('divHide');
							}else{
								$('#edimg'+(i+1)+'').attr('src',textJson_tem['imgArr'][i]);
							}
						}else{
							$('#edimg'+(i+1)+'').attr('src',textJson_tem['imgArr'][i]);
						}
					});



					//判断是否从音乐页面跳转回来
					if(sessionStorage.getItem('bgdMusic') == null){
						//渲染背景音乐
						bgdMusic = textJson_tem['bgdMusic'];
					}else{
						//渲染背景音乐
						bgdMusic = sessionStorage.getItem('bgdMusic');
					}

					//定位地图
					map61.init(textJson_tem['positionX'],textJson_tem['positionY']);
					

				}//else结尾

			}else{
				//预览返回
				var textJson_pre  = <{$user_preview_json}>;
				console.log("修改=$user_preview_json======"+JSON.stringify(textJson_pre));
				

				//渲染文字
				for(var key in textJson_pre.json){
					if(key =='ed12' || key =='ed13'){
						if(textJson_pre.json[key] == 'hide'){
							$('#swi3_cont_cont_1').addClass('divHide');
							$('#swi3_cont_img_1').addClass('divHide');
							$('#addBox1').removeClass('divHide');
						}else{
							$($('#'+key+'').selector).html(textJson_pre.json[key]);
						}
					}else if(key =='ed14' || key =='ed15'){
						if(textJson_pre.json[key] == 'hide'){
							$('#swi3_cont_cont_2').addClass('divHide');
							$('#swi3_cont_img_2').addClass('divHide');
							$('#addBox2').removeClass('divHide');
						}else{
							$($('#'+key+'').selector).html(textJson_pre.json[key]);
						}
					}else if(key =='ed16' || key =='ed17'){
						if(textJson_pre.json[key] == 'hide'){
							$('#swi3_cont_cont_3').addClass('divHide');
							$('#swi3_cont_img_3').addClass('divHide');
							$('#addBox3').removeClass('divHide');
						}else{
							$($('#'+key+'').selector).html(textJson_pre.json[key]);
						}
					}else if(key =='ed19'){
						if(textJson_pre.json[key] == 'hide'){
							$('#swi4_cont_one_1').addClass('divHide');
							$('#addBox4').removeClass('divHide');
						}else{
							$($('#'+key+'').selector).html(textJson_pre.json[key]);
						}
					}else if(key =='ed20'){
						if(textJson_pre.json[key] == 'hide'){
							$('#swi4_cont_one_2').addClass('divHide');
							$('#addBox5').removeClass('divHide');
						}else{
							$($('#'+key+'').selector).html(textJson_pre.json[key]);
						}
					}else if(key =='ed21'){
						if(textJson_pre.json[key] == 'hide'){
							$('#swi4_cont_one_3').addClass('divHide');
							$('#addBox6').removeClass('divHide');
						}else{
							$($('#'+key+'').selector).html(textJson_pre.json[key]);
						}
					}else if(key =='ed22'){
						if(textJson_pre.json[key] == 'hide'){
							$('#swi4_cont_two_1').addClass('divHide');
							$('#addBox7').removeClass('divHide');
						}else{
							$($('#'+key+'').selector).html(textJson_pre.json[key]);
						}
					}else if(key =='ed23'){
						if(textJson_pre.json[key] == 'hide'){
							$('#swi4_cont_two_2').addClass('divHide');
							$('#addBox8').removeClass('divHide');
						}else{
							$($('#'+key+'').selector).html(textJson_pre.json[key]);
						}
					}else if(key =='ed24'){
						if(textJson_pre.json[key] == 'hide'){
							$('#swi4_cont_two_3').addClass('divHide');
							$('#addBox9').removeClass('divHide');
						}else{
							$($('#'+key+'').selector).html(textJson_pre.json[key]);
						}
					}
					else{
						 $($('#'+key+'').selector).html(textJson_pre.json[key]);
					}
				}


				
				//渲染自定义图片
				//自定义图片的渲染
				$.each(textJson_pre.json['imgArr'],function(i){
					if( (i+1) == 2){
						if(textJson_pre.json['imgArr'][i] == 'hide'){
							$('#swi3_cont_img_1').addClass('divHide');
							$('#addBox1').removeClass('divHide');
						}else{
							$('#edimg'+(i+1)+'').attr('src',textJson_pre.json['imgArr'][i]);
						}
					}else if( (i+1) == 3){
						if(textJson_pre.json['imgArr'][i] == 'hide'){
							$('#swi3_cont_img_2').addClass('divHide');
							$('#addBox2').removeClass('divHide');
						}else{
							$('#edimg'+(i+1)+'').attr('src',textJson_pre.json['imgArr'][i]);
						}
					}else if( (i+1) == 4){
						if(textJson_pre.json['imgArr'][i] == 'hide'){ 
							$('#swi3_cont_img_3').addClass('divHide');
							$('#addBox3').removeClass('divHide');
						}else{
							$('#edimg'+(i+1)+'').attr('src',textJson_pre.json['imgArr'][i]);
						}
					}else{
						$('#edimg'+(i+1)+'').attr('src',textJson_pre.json['imgArr'][i]);
					}
				});




				//判断是否从音乐页面跳转回来
				if(sessionStorage.getItem('bgdMusic') == null){
					//渲染背景音乐
					bgdMusic = textJson_pre.json['bgdMusic'];
				}else{
					//渲染背景音乐
					bgdMusic = sessionStorage.getItem('bgdMusic');
				}

				//定位地图
				map61.init(textJson_pre.json['positionX'],textJson_pre.json['positionY']);


			}//else结尾




		}); //document结尾




		$(function() {
			//监听编辑框输入长度
			$('#edit_dialog').find('textarea').bind('input propertychange', function() {
				$('#edit_length').find('span:nth-child(1)').html($(this).val().length);
			});

		});

		//电话号码检查函数
		function checkphone(a) {
			var phone = a;
			var isPhone = /^1[34578]\d{9}$/;
			var isMob = /^0(([1,2]\d)|([3-9]\d{2}))\d{7,8}$/;
			var value = a.trim();
			if(/^1[34578]\d{9}$/.test(value)) {
				return true;
			} else if(isMob.test(value)) {
				if(phone.split("")[0] == 0) {
					if(phone.split("")[1] == 2) {
						var a1 = phone.substr(0, 3);
						var a2 = phone.substr(3, 10);
					} else {
						var a1 = phone.substr(0, 4);
						var a2 = phone.substr(4, 11);
					};
				};
				return true;
			} else {
				alert("请输入正确的手机号码或固定电话");
				return false;
			};

		};



		var galleryTop = new Swiper('.gallery-top', {
		 	nextButton: '.swiper-button-next',
	        prevButton: '.swiper-button-prev',
	        spaceBetween: 0,
			observer:true,
	    });
	    var galleryThumbs = new Swiper('.gallery-thumbs', {
	    	spaceBetween: 20,
	        centeredSlides: true,
	        slidesPerView: 'auto',
			observer:true,
			/*slidesOffsetAfter : -300,*/
	        touchRatio: 0.2,
	        slideToClickedSlide: true,
	        slidesOffsetBefore : -70,
	        onSlideChangeEnd: function(swiper){
				$('.gallery-thumbs .swiper-slide input').attr("disabled","disabled");
			},
			onSlideChangeStart: function(swiper){
			},
			onTouchEnd: function(swiper){
				$('.gallery-thumbs .swiper-slide-active input').removeAttr("disabled");
	    	},

		});
		galleryTop.params.control = galleryThumbs;
		galleryThumbs.params.control = galleryTop;


		var swiper = new Swiper('.text_swiper', {
			direction: 'vertical',
			pagination: {
				el: '.swiper-pagination',
				clickable: true,
			},
			onTouchStart: function(swiper, even) {
				swiper.params.allowSwipeToPrev = true;
				swiper.params.allowSwipeToNext = true;
				if($("#swi1").hasClass("swiper-slide-active")) { swiper.params.allowSwipeToPrev = false; };
			},
			onSlideChangeStart: function(swiper) {
				//改变页码
				var pageNum = parseInt(swiper.activeIndex + 1);
				$('#pageNum').find('span').html(pageNum);
				//底部的举报
				if(pageNum == 5) {
					$('#report_div').fadeIn(500);
				} else {
					$('#report_div').fadeOut(1000);
				}
			},
			onTouchEnd: function(swiper) {
				//改变页码
				var pageNum = parseInt(swiper.activeIndex + 1);
				$('#pageNum').find('span').html(pageNum);
			},
			onInit: function(swiper) {
				//小地图
				// map61.init(positionX, positionY);
			},
			onTouchMove: function(swiper) {
				$(".slider").removeClass("on");
			},
		});
		$(document).ready(function() {

			//去除地图logo
			$("#container_61").bind("DOMNodeInserted", function(e) {
				var tempCount = 0;
				$("#container_61 .smnoprint").siblings().each(function() {
					tempCount++;
					if(tempCount == 2 || tempCount == 3) {
						$(this).remove();
					}
				});
			});


			//给活动开始时间戳一个默认值
			var myDate = new Date(); 
			var stringTime;
			if($('#ed3').text().length == 1){
			 	if ($('#ed4').text().length == 2) {
			 		stringTime = myDate.getFullYear()+"-0"+$('#ed3').text()+"-"+$('#ed4').text();
			 	}else{
			 		stringTime = myDate.getFullYear()+"-0"+$('#ed3').text()+"-0"+$('#ed4').text();
			 	}
			}else{
				if ($('#ed4').text().length == 2) {
			 		stringTime = myDate.getFullYear()+"-"+$('#ed3').text()+"-"+$('#ed4').text();
			 	}else{
			 		stringTime = myDate.getFullYear()+"-"+$('#ed3').text()+"-0"+$('#ed4').text();
			 	}
				
			}
			var timestamp2 = Date.parse(new Date(stringTime));
			timestampStart = timestamp2 / 1000;

			// alert(timestampStart+"开始时间戳");


			//日历
			//日期触发函数
			var now = new Date(),
				max = new Date(now.getFullYear(), now.getMonth(), now.getDate());
			var currYear = now.getFullYear();
			var currMonth = now.getMonth();
			var currDay = now.getDate();

			$('#date_input_1').mobiscroll().date({
				seconds: false,
				ampm: false,
				lang: 'zh',
				dateOrder: 'yymd',
				theme: 'android-ics light',
				startYear: currYear, //开始年份
				setText: '确定',
				cancelText: '取消',
				display: 'bottom',
				onSelect: function(valueText, inst) {
					console.log(inst.val);


					// 获取某个时间格式的时间戳
					var stringTime = inst.val;
					var timestamp2 = Date.parse(new Date(stringTime));
					timestampStart = timestamp2 / 1000;
					//2014-07-10 10:21:12的时间戳为：1404958872 
					console.log(stringTime + "的时间戳为：" + timestampStart);



					var newYear = inst.temp[0]; //年
					var newMonth = inst.temp[1]; //月
					var newDay = inst.temp[2]; //日

					var newWeek = new Date(newYear, newMonth, (newDay));
					var weekArray = new Array("星期日", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六");
					var week = weekArray[newWeek.getDay()]; // 星期

					$('#ed3').html(parseInt(newMonth) + 1);
					$('#ed4').html(newDay);
				}
			});



			$('#date_input_2').mobiscroll().date({
				seconds: false,
				ampm: false,
				lang: 'zh',
				dateOrder: 'yymd',
				theme: 'android-ics light',
				startYear: currYear, //开始年份
				setText: '确定',
				cancelText: '取消',
				display: 'bottom',
				onSelect: function(valueText, inst) {


					// 获取某个时间格式的时间戳
					var stringTime = inst.val;
					var timestamp2 = Date.parse(new Date(stringTime));
					timestampStop = timestamp2 / 1000;
					//2014-07-10 10:21:12的时间戳为：1404958872 
					console.log(stringTime + "的时间戳为：" + timestampStop);

					//结束时间不能小于开始时间
					if(timestampStop > timestampStart){
						var newYear = inst.temp[0]; //年
						var newMonth = inst.temp[1]; //月
						var newDay = inst.temp[2]; //日

						var newWeek = new Date(newYear, newMonth, (newDay));
						var weekArray = new Array("星期日", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六");
						var week = weekArray[newWeek.getDay()]; // 星期

						$('#ed5').html(parseInt(newMonth) + 1);
						$('#ed6').html(newDay);
					}else{
						alert("活动结束时间不能小于活动开始时间！");
					}


					
				}
			});



		});

		//编辑框触发函数
		function edit_onFuntion(faThis, allLength) {
			var oldText = faThis.text();
			//如果是电话就显示input标签框，隐藏textare
			if(faThis[0].id == 'ed27') {
				$('#edit_dialog').removeClass('divHide');
				$('#edit_layer').removeClass('divHide');
				$('#edit_length').find('span:nth-child(1)').html(oldText.length);
				$('#edit_length').find('span:nth-child(2)').html(allLength);
				//显示input
				$('#edit_number_input').removeClass('divHide');
				$('#edit_input_layer').removeClass('divHide');
				$('#edit_number_input').attr('maxlength', allLength);
				$('#edit_number_input').val(oldText);
				$('#edit_dialog').find('ul').append('<li style="display:none;">' + faThis.attr("id") + '</li>');
			} else {
				//因为描述太长导致确定按钮变形
				if(faThis[0].id == 'ed7') {
					$('#edit_dialog').find('li:nth-child(2)').css('margin', '0 37%');
				} else {
					$('#edit_dialog').find('li:nth-child(2)').css('margin', '0 39%');
				}
				$('#edit_dialog').removeClass('divHide');
				$('#edit_layer').removeClass('divHide');
				$('#edit_number_input').addClass('divHide');
				$('#edit_input_layer').addClass('divHide');
				$('#edit_length').find('span:nth-child(1)').html(oldText.length);
				$('#edit_length').find('span:nth-child(2)').html(allLength);
				$('#edit_dialog').find('textarea').attr('maxlength', allLength);
				$('#edit_dialog').find('textarea').text(oldText);
				$('#edit_dialog').find('ul').append('<li style="display:none;">' + faThis.attr("id") + '</li>');
			}

		}

		//点击编辑框的取消函数
		function edit_qxFun() {
			$('#edit_dialog').addClass('divHide');
			$('#edit_layer').addClass('divHide');
			//删除新建的li
			$('#edit_dialog').find('li:nth-child(4)').remove();
		}

		//点击编辑框的确定函数
		function edit_qdFun() {
			//修改后的文本
			var textVal = $('#edit_dialog').find('textarea').val();
			//修改的Id
			var Pid = $('#edit_dialog').find('li:nth-child(4)').text();

			//判断电话号码
			if(Pid == "ed27") {
				var textVal2 = $('#edit_number_input').val();
				var a = checkphone(textVal2);
				if(a == true) {
					$('#' + Pid + '').text(textVal2);

					$('#edit_dialog').addClass('divHide');
					$('#edit_layer').addClass('divHide');
					//删除新建的li
					$('#edit_dialog').find('li:nth-child(4)').remove();
				}
			} else {
				$('#' + Pid + '').text(textVal);
				$('#edit_dialog').addClass('divHide');
				$('#edit_layer').addClass('divHide');
				//删除新建的li
				$('#edit_dialog').find('li:nth-child(4)').remove();
			}
		}

		//切换课程函数
		function changeClassFun(faThis) {
			var pIndex = faThis.parent().attr('value');
			faThis.remove();
			for(var i = 1; i <= 3; i++) {
				//选中的
				if(i != pIndex) {
					//判断是否已经存在i标签
					if($('#swi3_cont_img_' + i).find('i').length == 0 && $('#swi3_cont_img_' + i).hasClass('divHide') == false) {
						$('#swi3_cont_img_' + i).prepend('<i class="swi3_cont_img_layer" onclick="changeClassFun($(this))"></i>');
					}
				}
			}
			$('#swi3_cont_cont_' + pIndex).removeClass('divHide').siblings().addClass('divHide');
		}

		//分享封面图片
		var imgArr = new Array();

		//自定义图片（裁剪）函数
		//file_id上传图片的（input）id，view_id:截图完成显示的id(img);
		//view_width,view_height:截取区域宽高，imgIndex:图片的下标
		function clipPhoto(file_id, view_id, view_width, view_height, imgIndex) {
			var v_id;
			//等于-1就是分享图片
			if(imgIndex != -1) {
				v_id = '#' + $(view_id)[0].id;
				$(view_id).next().click();
			} else {
				v_id = view_id;
			}
			$("#clipArea").photoClip({
				width: view_width,
				height: view_height,
				file: file_id,
				view: v_id, //传进来的$(this),所以要拿id
				ok: "#clipBtn", //确定裁剪的按钮
				loadStart: function() {
					//开始加载回调函数，this指向 fileReader 对象
					$(".caiBox").show();
				},
				loadComplete: function() {
					//加载完成的回调函数。this指向图片对象
				},
				clipFinish: function(dataURL) {
					//裁剪完成的回调函数。this指向图片对象
					$(v_id).attr('src', dataURL);
					if(imgIndex != '-1') {
						//给自定义图片数组赋值（不包含分享图片）
						imgArr[imgIndex] = dataURL;
					} else {
						tal_shareBgi.push(dataURL);
					}
					//隐藏截图页面
					$(".caiBox").hide();
					//放大缩小后从新渲染截图背景
					render(dataURL);
					//清空上一张图片的缓存
					$(".photo-clip-mask").remove();
					$(".photo-clip-view").remove();
				}
			});
		};
		//关闭裁剪函数
		function Close() {
			$('.caiBox').hide();
		}
		// 渲染 Image 缩放尺寸  
		function render(src) {
			var MAX_HEIGHT = 256; //Image 缩放尺寸 
			// 创建一个 Image 对象  
			var image = new Image();

			// 绑定 load 事件处理器，加载完成后执行  
			image.onload = function() {
				// 获取 canvas DOM 对象  
				var canvas = document.getElementById("myCanvas");
				// 如果高度超标  
				if(image.height > MAX_HEIGHT) {
					// 宽度等比例缩放 *=  
					image.width *= MAX_HEIGHT / image.height;
					image.height = MAX_HEIGHT;
				}
				// 获取 canvas的 2d 环境对象,  
				// 可以理解Context是管理员，canvas是房子  
				var ctx = canvas.getContext("2d");
				// canvas清屏  
				ctx.clearRect(0, 0, canvas.width, canvas.height);
				canvas.width = image.width; // 重置canvas宽高  
				canvas.height = image.height;
				// 将图像绘制到canvas上  
				/*ctx.drawImage(image, 0, 0, image.width, image.height); */
				// !!! 注意，image 没有加入到 dom之中  

				var dataurl = canvas.toDataURL("image/jpeg");
				var imagedata = encodeURIComponent(dataurl);
			};
			// 设置src属性，浏览器会自动加载。  
			// 记住必须先绑定render()事件，才能设置src属性，否则会出同步问题。  
			image.src = src;
		};

		//课程删除、添加按钮
		function closeFun(faFirst, faTwo, faThree) {
			$(faFirst).addClass('divHide');
			$(faTwo).removeClass('divHide');
			$(faThree).addClass('divHide');
		}

		function addFun(faFirst, faTwo, faThree) {
			$(faFirst).removeClass('divHide');
			$(faTwo).addClass('divHide');
			$(faThree).removeClass('divHide').siblings().addClass('divHide');
		}
		
		//地图
		var map60 = new wap_qq_map('container_60');
		map60.edit = true;
		map60.show_marker = false;
		map60.lat_input = $('[name="lat"]').get(0);
		map60.lng_input = $('[name="lng"]').get(0);
		map60.lat_input = $("#lat").get(0);
		map60.lng_input = $("#lng").get(0);
		map60.icon = 'http://qhb.lelego.net.cn/upload/tpl_file/public/module_icon-location.png';
		var now_address = "";
		var have_addr60 = true;
		map60.returnAddress = function(v) {

			//赋予坐标
			positionX = v[0].latLng.lat;
			positionY = v[0].latLng.lng

			console.log("坐标===="+positionX,positionY);


			if(v) {
				$('.newmap').html('');
				for(var i = 0; i < v.length; i++) {
					var new_address = v[i].address + ' ' + v[i].name;
					var c = '';
					if(new_address == now_address) c = 'checked';
					now_address == new_address;
					$('.newmap').append('<input type="text" value="' + v[0].address + v[0].name + '"/>');
					var ab = $('.newmap input:nth-child(1)').show();
				}
				$('#Address_list').show();
			}

			if(have_addr60) {
				$('#Address_list [name="address1"]:checked').parent().parent().siblings().remove();
			}
			have_addr60 = false;
		}

		//点击编辑地址或地图函数
		function new_map() {
			$(".map_new").show();
			$('#edit_layer').removeClass('divHide');
			var geolocation = new qq.maps.Geolocation("VSFBZ-MXGCK-MHYJT-AHOUS-INSNH-CVFEF", "container_60");
			var options = { timeout: 2000 };
			geolocation.getLocation(showPosition1, showErr1, options);

			function showPosition1(position) {
				map60.init(position.lat, position.lng);
			};

			function showErr1() {
				map60.init(0, 0);
			};
		};

		//点击编辑地图的确定函数
		function que() {
			var address = $("input[name='lat']").val() + "," + $("input[name='lng']").val();
			$(".map_new").hide();
			$('#edit_layer').addClass('divHide');
			var text = $(".newmap input:nth-child(1)").val();
			$('#ed24').text(text);
			map61.init(positionX, positionY);
		};
		



		//获取文字和图片的函数
		function submitFun() {
			//获取文字
			for(var i = 1; i <= 28; i++) {
				if(i == 12 || i == 13) {
					console.log($('#addBox1').hasClass('divHide'));
					//判断是否存在i标签
					if($('#addBox1').hasClass('divHide') == true) {
						textJson['ed' + i] = $('#ed' + i).html();
					}else{
						textJson['ed' + i] = 'hide';
					}
				}else if(i == 14 || i == 15) {
					//判断是否存在i标签
					if($('#addBox2').hasClass('divHide') == true) {
						textJson['ed' + i] = $('#ed' + i).html();
					}else{
						textJson['ed' + i] = 'hide';
					}
				}else if(i == 16 || i == 17) {
					//判断是否存在i标签
					if($('#addBox3').hasClass('divHide') == true) {
						textJson['ed' + i] = $('#ed' + i).html();
					}else{
						textJson['ed' + i] = 'hide';
					}
				}else if(i == 19) {
					//判断是否存在i标签
					if($('#addBox4').hasClass('divHide') == true) {
						textJson['ed' + i] = $('#ed' + i).html();
					}else{
						textJson['ed' + i] = 'hide';
					}
				}else if(i == 20) {
					//判断是否存在i标签
					if($('#addBox5').hasClass('divHide') == true) {
						textJson['ed' + i] = $('#ed' + i).html();
					}else{
						textJson['ed' + i] = 'hide';
					}
				}else if(i == 21) {
					//判断是否存在i标签
					if($('#addBox6').hasClass('divHide') == true) {
						textJson['ed' + i] = $('#ed' + i).html();
					}else{
						textJson['ed' + i] = 'hide';
					}
				}else if(i == 22) {
					//判断是否存在i标签
					if($('#addBox7').hasClass('divHide') == true) {
						textJson['ed' + i] = $('#ed' + i).html();
					}else{
						textJson['ed' + i] = 'hide';
					}
				}else if(i == 23) {
					//判断是否存在i标签
					if($('#addBox8').hasClass('divHide') == true) {
						textJson['ed' + i] = $('#ed' + i).html();
					}else{
						textJson['ed' + i] = 'hide';
					}
				}else if(i == 24) {
					//判断是否存在i标签
					if($('#addBox9').hasClass('divHide') == true) {
						textJson['ed' + i] = $('#ed' + i).html();
					}else{
						textJson['ed' + i] = 'hide';
					}
				}
				else{
					textJson['ed' + i] = $('#ed' + i).html();
				}
			}


			//获取图片
			for(var i = 1;i <= 4;i++){
				if(i == 2){
					//判断是否存在i标签
					if($('#addBox1').hasClass('divHide') == true) {
						imgArr[i - 1] = $('#edimg' + i).attr('src');
					} else {
						imgArr[i - 1] = 'hide';
					}
				}else if( i == 3){
					//判断是否存在i标签
					if($('#addBox2').hasClass('divHide') == true) {
						imgArr[i - 1] = $('#edimg' + i).attr('src');
					} else {
						imgArr[i - 1] = 'hide';
					}
				}else if(i == 4){
					//判断是否存在i标签
					if($('#addBox3').hasClass('divHide') == true) {
						imgArr[i - 1] = $('#edimg' + i).attr('src');
					} else {
						imgArr[i - 1] = 'hide';
					}
				}else{
					imgArr[i - 1] = $('#edimg' + i).attr('src');
				}
			}




			//保存之前先将base64的图片转成url
			$.each(imgArr,function(i){
				//判断是否存在base64的图片
				if(imgArr[i].indexOf('base64') != -1){
					$.ajax({
						type: "post",
						url: "http://<{$sys_domain}>/modules/wap_user_tpl_edit/post.php?class=update_image",
						type: "POST",
						dataType: "json",
						async:false,
						data: {
							userid: '<{$template_user_id}>',
							image_base64: imgArr[i],
						},
						success: function(data) {
							imgArr[i] = data.data.url;
						}
					});
				}
			});


			//将自定义图片存进textJson
			textJson['imgArr'] = imgArr;

			//将背景音乐存进textJson
			textJson['bgdMusic'] = bgdMusic;

			//坐标添加进textJson里
			textJson['positionX'] = positionX;
			textJson['positionY'] = positionY;
		}


		//点击预览函数
		function previewFun() {

			//获取文字和图片
			submitFun();

			console.log(textJson);


			//预览上传
			$.ajax({
				type: "post",
				url: "http://<{$sys_domain}>/modules/wap_user_tpl_edit/post.php?class=preview&pid=<{$user_template_id}>",
				dataType: "json",
				data: {
					json: JSON.stringify(textJson),
					id: '<{$user_template_id}>',
					userid: '<{$template_user_id}>',
					tpl_project_name: '春季报名01',
					tpl_amount: 0,
					tplid: '<{$template_id}>',
					tpl_people: 10000,
					tpl_title: '<{$user_template_title}>',
					tpl_digest: '<{$user_template_digest}>',
				},
				success: function(data) {
					debugger;
					if(data.status == true){
						location.href = '<{$user_template_url}>&a=1';
					}else{
						alert('预览失败！');
					}
				}
			});

			
		}




		//点击音乐的函数
		function changeMiuscFun(){
			

			//获取文字和图片
			submitFun();

			console.log(textJson);

			//音乐上传
			$.ajax({
				type: "post",
				url: "http://<{$sys_domain}>/modules/wap_user_tpl_edit/post.php?class=preview&pid=<{$user_template_id}>",
				dataType: "json",
				data: {
					json: JSON.stringify(textJson),
					id: '<{$user_template_id}>',
					userid: '<{$template_user_id}>',
					tpl_project_name: '寒假报名01', 
					tpl_amount: 0,
					tplid: '<{$template_id}>',
					tpl_people: 10000,
					tpl_title: '<{$user_template_title}>',
					tpl_digest: '<{$user_template_digest}>',
				},
				success: function(data) {
					if(data.status == true){
						//记得传pid=<{$user_template_id}>，否则编辑保存时会新建一个
						//window.location.href="http://192.168.1.88/wap.php?lang=cn&pid=<{$user_template_id}>&id=44&tpl_id=31&file=module_music.tpl&public=1";

						window.location.href="http://<{$sys_domain}>/wap.php?id=44&lang=cn&pid=<{$user_template_id}>&tpl_id=<{$template_id}>&public=1&file=module_music.tpl";

					}else{
						alert('音乐失败！');
					}
				}
			});

		}




		//初始化弹框
		layui.use('layer', function() { //独立版的layer无需执行这一句
			var $ = layui.jquery,
				layer = layui.layer; //独立版的layer无需执行这一句
		});


		//保存弹框的函数
		function saveDialog() {
			var title = '<{$user_template_title}>' || '寒假报名';
			var miaoshu = '<{$user_template_digest}>' || '小蜜蜂琴行祝大家寒假快乐';
			var img_input = '<{$template_image}>';
			var tamp = "<form>";
			tplTitle = '<{$user_template_title}>' || '寒假报名';;
			tplDigest = '<{$user_template_digest}>' || '小蜜蜂琴行祝大家寒假快乐';
			tamp += "<div class='fen_title fen_title1' style='border-bottom:1px soild #ccc'>";
			tamp += "<label>分享标题：</label><input type='text' id='fen_t'  placeholder='请输入标题' value='" + title + "' />";
			tamp += "</div>";
			tamp += "<div class='fen_title'>";
			tamp += "<div class='left_box' onclick='fen_img.click()' ><i>更换封面</i>";
			tamp += "<input type='file' accept='image/*' id='fen_img' onClick=\"clipPhoto('#fen_img','#imgload','120','120','-1')\" value='请点击上传图片' style='display:none;' />";
			tamp += "<img src='" + img_input + "' class='my_img' id='imgload'/>";
			tamp += "</div>";
			tamp += "<div class='fen_title2'><textarea name='message' maxlength='60'  id='fen_miaoshu'>" + miaoshu + "</textarea><p id='dia_pageNum'><span>1</span><span>/</span><span>60</span></p></div>";
			tamp += "</div>";
			tamp += "<div class='layer_btn'>";
			tamp += "<a id='shareSave'>保存</a>";
			tamp += "</div>";
			tamp += "<div class='tishi'>这是分享后朋友们看见的标题、摘要和封面，请记得修改哦!</div>";
			tamp += "</form>";
			layer.open({
				skin:'winning-class',
				title: false,
				content: tamp,
				btn: false,
				success: function(layero) {
					$('' + layero.selector + '').find("div").css({ 'overflow': 'inherit' });
					$('.layui-layer-shade').css('opacity', '0.7');
					//textare的原本长度
					$('#dia_pageNum').find('span:nth-child(1)').html(miaoshu.length);
					//给分享图片赋予默认值
					shareBgi = '<{$template_image}>';
				}
			});

			$('#fen_t').change(function() {
				tplTitle = $(this).val()
			});

			$('#fen_miaoshu').change(function() {
				tplDigest = $(this).val()
			});

			$('#fen_miaoshu').bind('input propertychange', function() {
				$('#dia_pageNum').find('span:nth-child(1)').html($(this).val().length);
			});

			
			//点击分享保存
			$('.layer_btn').click(function() {

				if($('#fen_t').val() == "" || $('#fen_miaoshu') == "") {
					alert("请填写分享标题或内容~");
					return false;
				} else {

					
					//获取文字和图片
					submitFun();

					console.log(textJson);

					//保存之前先将base64的分享图片转成url
					$.each(tal_shareBgi,function(i){
						//判断是否存在base64的图片
						if(tal_shareBgi[0].indexOf('base64') != -1){
							$.ajax({
								type: "post",
								url: "http://<{$sys_domain}>/modules/wap_user_tpl_edit/post.php?class=update_image",
								type: "POST",
								dataType: "json",
								async:false,
								data: {
									userid: '<{$template_user_id}>',
									image_base64: tal_shareBgi[0],
								},
								success: function(data) {
									tal_shareBgi[0] = data.data.url;
								}
							});
						}
					});


					//保存文字
					$.ajax({
						type: "post",
						url: "http://<{$sys_domain}>/modules/wap_user_tpl_edit/post.php?class=update",
						dataType: "json",
						data: {
							json: JSON.stringify(textJson),
							id: '<{$user_template_id}>',
							userid: '<{$template_user_id}>',
							tpl_project_name: '元旦节3',
							tpl_amount: 0,
							tplid: '<{$template_id}>',
							tpl_people: 10000,
							tpl_title: tplTitle,
							tpl_digest: tplDigest,
							tpl_img: tal_shareBgi[0],
							tpl_amount: ""
						},
						success: function(data) {
							debugger;
							//如果等于‘0’就是新增的，跳转页面时加上返回的uniqid
							if(data.status = true && '<{$user_template_id}>' == 0) {
								location.href = '<{$user_template_url}>' + data.data.uniqid;
							} else if(data.status = true){
								location.href = '<{$user_template_url}>';
							}else{
								alert(data.data.msg);
							}

						}
					});

				}

		});

	}


		
		
	</script>
	<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
	<script>
		document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
			// if(sessionStorage.getItem('a') == 1) {
				// 通过下面这个API隐藏右上角按钮
				WeixinJSBridge.call('hideOptionMenu');
			// } else {
			// 	WeixinJSBridge.call('showOptionMenu');
			// }
		});
		wx.config({
			appId: '<{$wxjs_appId}>',
			timestamp: <{$wxjs_timestamp}>,
			nonceStr: '<{$wxjs_nonceStr}>',
			signature: '<{$wxjs_signature}>',
			jsApiList: [
				'onMenuShareTimeline',
				'onMenuShareAppMessage',
				'onMenuShareQQ',
				'onMenuShareWeibo'
			]
		});
		wx.ready(function () {
		  var share_url=window.location.href;
		  var share_imgUrl='<{$template_image}>'; 
		  var t1 = '<{$user_template_title}>';
		  var t2 ='<{$user_template_digest}>';
		  var shareData = {
			title: t1,
			desc: t2,
			link: share_url,
			'imgUrl': share_imgUrl
		  };
		  wx.onMenuShareAppMessage(shareData);
		  wx.onMenuShareTimeline(shareData);
		  wx.onMenuShareQQ(shareData);
		  wx.onMenuShareWeibo(shareData);
		});
		wx.error(function (res) {
		  /*alert(res.errMsg);*/
		  //alert('<{$wxjs_appId}>'+'+'+'<{$wxjs_timestamp}>'+'+'+'<{$wxjs_nonceStr}>'+'+'+'<{$wxjs_signature}>')
		});
	</script>


</html>