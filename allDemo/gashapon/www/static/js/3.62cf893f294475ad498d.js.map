{"version":3,"sources":["webpack:///src/page/login/login.vue","webpack:///./src/page/login/login.vue?d825","webpack:///./src/page/login/login.vue"],"names":["login","data","Request","this","$api","util","$util","prototype","mounted","components","computed","methods","that","skipUrl","window","location","protocol","host","then","res","code","$cookies","remove","href","getAccessTokenFun","codeString","_this","asyncToGenerator_default","regenerator_default","a","mark","_callee","wrap","_context","prev","next","getAccessToken","getOS","console","log","set","openid","access_token","stop","created","_this2","$router","history","current","query","getQueryString","get","undefined","url","http","doMain","login_login","render","_h","$createElement","_self","_c","staticClass","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"mJASAA,GACAC,KADA,WAEA,OACAC,QAAAC,KAAAC,KACAC,KAAAF,KAAAG,MAAAD,KAAAE,YAIAC,QARA,aAYAC,cAGAC,YAGAC,SAEAX,MAAA,WACA,IAAAY,EAAAT,KACAU,EAAAC,OAAAC,SAAAC,SAAA,KAAAF,OAAAC,SAAAE,KAAA,WACAL,EAAAV,QAAAF,MAAAa,GACAK,KAAA,SAAAC,GACA,GAAAA,EAAAC,OAEAR,EAAAS,SAAAC,OAAA,UACAV,EAAAS,SAAAC,OAAA,gBACAR,OAAAC,SAAAQ,KAAAJ,EAAAlB,SAKAuB,kBAhBA,SAgBAC,GAAA,IAAAC,EAAAvB,KAAA,OAAAwB,IAAAC,EAAAC,EAAAC,KAAA,SAAAC,IAAA,IAAAnB,EAAA,OAAAgB,EAAAC,EAAAG,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cACAvB,EAAAc,EADAO,EAAAE,KAAA,EAEAvB,EAAAV,QAAAkC,eAAAX,EAAAb,EAAAP,KAAAgC,SACAnB,KAAA,SAAAC,GACAmB,QAAAC,IAAApB,GACA,GAAAA,EAAAC,OAGAR,EAAAS,SAAAmB,IAAA,SAAArB,EAAAlB,KAAAwC,OAAA,MACA7B,EAAAS,SAAAmB,IAAA,eAAArB,EAAAlB,KAAAyC,aAAA,SATA,wBAAAT,EAAAU,SAAAZ,EAAAL,KAAAC,KAcAiB,QAhDA,WAgDA,IAAAC,EAAA1C,KAIAiB,EAAAjB,KAAA2C,QAAAC,QAAAC,QAAAC,MAAA7B,MAAAjB,KAAAE,KAAA6C,eAAA,QAIA,SAAA/C,KAAAkB,SAAA8B,IAAA,kBAAA/B,EAEAjB,KAAAH,aAOA,QAAAoD,GAAAjD,KAAAkB,SAAA8B,IAAA,UAEAhD,KAAAqB,kBAAAJ,GACAF,KAAA,SAAAC,GAEA,IAAAkC,EAAAR,EAAAxB,SAAA8B,IAAA,kBAGAG,EAAAxC,OAAAC,SAAAC,SACAuC,EAAAzC,OAAAC,SAAAE,KACAH,OAAAC,SAAAQ,KAAA+B,EAAA,KAAAC,EAAA,IAAAF,EAEAR,EAAAxB,SAAAC,OAAA,wBAEA,CACA,IAAAgC,EAAAxC,OAAAC,SAAAC,SACAuC,EAAAzC,OAAAC,SAAAE,KAEAH,OAAAC,SAAAQ,KAAA+B,EAAA,KAAAC,EAAA,OCzFeC,GADEC,OAFjB,WAA0B,IAAaC,EAAbvD,KAAawD,eAAkD,OAA/DxD,KAAuCyD,MAAAC,IAAAH,GAAwB,OAAiBI,YAAA,eAEzFC,oBCCjB,IAcAC,EAdyBC,EAAQ,OAcjCC,CACElE,EACAwD,GATF,EAVA,SAAAW,GACEF,EAAQ,SAaV,kBAEA,MAUeG,EAAA,QAAAJ,EAAiB","file":"static/js/3.62cf893f294475ad498d.js","sourcesContent":["<template>\r\n\t<div class=\"container\">\r\n\t\t<!--<h1>授权中。。。</h1>-->\r\n\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\n\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tRequest: this.$api, //请求头\r\n\t\t\t\tutil: this.$util.util.prototype, //工具类\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t},\r\n\t\tmounted() {\r\n\t\t\t\r\n\r\n\t\t},\r\n\t\tcomponents: {\r\n\t\t\t\r\n\t\t},\r\n\t\tcomputed: {\r\n\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t//用户登录授权\r\n\t\t\tlogin:function(){\r\n\t\t\t\tvar that = this;\r\n\t\t\t\tvar skipUrl = window.location.protocol +'//'+window.location.host+'/#/login';\r\n\t\t\t\tthat.Request.login(skipUrl)\r\n\t\t\t\t\t.then(res =>{\r\n\t\t\t\t\t\t\tif(res.code == 0){\r\n\t\t\t\t\t\t\t\t//删除openid,access_token\r\n\t\t\t\t\t\t\t\tthat.$cookies.remove('openId');\r\n\t\t\t\t\t\t\t\tthat.$cookies.remove('access_token');\r\n\t\t\t\t\t\t\t\twindow.location.href=res.data;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t//获取用户openid\r\n\t\t\tasync getAccessTokenFun(codeString){\r\n\t\t\t\tvar that = this;\r\n\t\t\t\tawait that.Request.getAccessToken(codeString,that.util.getOS())\r\n\t\t\t\t\t.then(res =>{\r\n\t\t\t\t\t\tconsole.log(res)\r\n\t\t\t\t\t\tif(res.code == 0){\r\n\t\t\t\t\t\t\t//localStorage.setItem('openId',res.data.openid);\r\n\t\t\t\t\t\t\t//localStorage.setItem('access_token',res.data.access_token);\r\n\t\t\t\t\t\t\tthat.$cookies.set('openId',res.data.openid,60*60*2);\r\n\t\t\t\t\t\t\tthat.$cookies.set('access_token',res.data.access_token,60*60*2);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t}\r\n\t\t},\r\n\t\tcreated() {\r\n\t\t\tvar that = this;\r\n\r\n\t\t\t//获取登录回来的code\r\n\t\t\tvar code = this.$router.history.current.query.code || this.util.getQueryString('code');\r\n\t\t\t\r\n\t\t\t//判断当前url中有没有  code\r\n\t\t\t//未登录，而且没有code的情况下\r\n\t\t\tif(this.$cookies.get('isLogin') == null && code == null){\r\n\t\t\t\t//跳转微信登录\r\n\t\t\t\tthis.login();\r\n\t\t\t}\r\n\t\t\t//未登录,有code\r\n\t\t\telse{\r\n\t\t\t\t//由于怕用户一直返回到授权页面，\r\n\t\t\t\t//所以在授权页面判断是否已经获取用户信息\r\n\t\t\t\t//如果已经获取用户信息则跳转到首页\r\n\t\t\t\tif(this.$cookies.get('openId') == undefined){\r\n\t\t\t\t\t//获取用户信息\r\n\t\t\t\t\tthis.getAccessTokenFun(code)\r\n\t\t\t\t\t\t.then(res =>{\r\n\t\t\t\t\t        //获取beforeLoginUrl，我们的前端页面\r\n\t\t\t\t\t        let url = this.$cookies.get('beforeLoginUrl');\r\n\t\t\t\t            //跳转  用window.location.href 地址栏不会带code\r\n\t\t\t\t            //this.$router.push({path:url});\r\n\t\t\t\t\t\t\tvar http = window.location.protocol;\r\n\t\t\t\t            var doMain = window.location.host;\r\n\t\t\t\t            window.location.href = http+'//'+doMain+'#'+url;\r\n\t\t\t\t            //删除 cookie中beforeLoginUrl\r\n\t\t\t\t            this.$cookies.remove('beforeLoginUrl');\r\n\t\t\t\t\t\t})\r\n\t\t\t\t}else{\r\n\t\t\t        var http = window.location.protocol;\r\n\t\t            var doMain = window.location.host;\r\n\t\t\t\t\t//调回首页\r\n\t\t\t\t\twindow.location.href = http+'//'+doMain+'#';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t\r\n\t\t},\r\n\r\n\t}\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n\t\r\n</style>\n\n\n// WEBPACK FOOTER //\n// src/page/login/login.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"container\"})}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-21f9ab54\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"audio\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/page/login/login.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true,\\\"publicPath\\\":\\\"../../\\\"}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-21f9ab54\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!less-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./login.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./login.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./login.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-21f9ab54\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"audio\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./login.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-21f9ab54\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/page/login/login.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}